\section{Introduction} 
During the latest stage of structure formation, the universe gave birth to
non-linear, hierarchical structures known as galaxy clusters. 
These clusters, made up of dark matter, galaxies and hot gas,
are constantly accreting mass, merging and evolving with their
environments. Bright galaxies that belong to a galaxy cluster or group, in 
particular, highlight the overdensities of the underlying dark matter (DM) 
distribution. In dense regions of the clusters, the rates of particle
interactions may be enhanced, including the hypothetical self-interaction of DM
particles (hereafter, SIDM). Having SIDM with a small cross section
$\sigmaSIDM$, instead of a Cold-Dark Matter (CDM) model with zero $\sigma_{\rm
SIDM}$, 
may relieve the potential discrepancies 
between our current cosmological model and observations. These discrepancies include the 
``core vs cusp" problem, which describes the observation of cores instead of
cuspy density profiles in the central regions of
(dwarf) galaxies that CDM predicts (\citealt{Rocha2013a},
Studying systems of larger scales such as galaxy clusters, may provide independent 
evidence on whether SIDM fits observations better. 

In particular, efforts have focused on studying SIDM observables 
using simulations of merging galaxy clusters.
As the SIDM scattering rates can be shown to depend on the 
relative velocities of the DM particles \citep{Markevitch2004}, the high
velocities and column densities 
in cluster mergers may produce an SIDM signal. This idea was verified by 
\cite{Randall2008d}, who used the first suites of simulations of the
Bullet Cluster that included SIDM physics. 
\cite{Randall2008d} showed that the scattering events of SIDM can cause the DM
to lag behind the relatively collisionless galaxies, thus resulting in an offset.
Throughout this work, we denote this offset that is due to the effects of SIDM
in a merger as:
\begin{equation}
	\offset_{\SIDM} \equiv {\bf s}_{\rm gal} - {\bf s}_{\rm DM}.
	\label{eq:offset}
\end{equation}
where $\bf{s}_{gal}$ and $\bf{s}_{DM}$ are the two-dimensional (2D) spatial
locations of the summary statistic of the galaxy population, and the density
peak of DM respectively. 
It is also noteworthy that \cite{Randall2008d} showed an almost linear dependence of
$\offset_{\SIDM}$ on $\sigmaSIDM$ in Bullet Cluster simulations. 
% To probe the possible self-interaction cross section $\offset_{\SIDM}$ of DM,
% many papers have used the spatial offsets between the `center' of the DM 
% distribution and those of the member galaxies (\citealt{Markevitch2004}, 
% \citealt{Dawson12}, \citealt{Merten2011},
% \citealt{Williams2011a}, \citealt{Mohammed2014}, and
% others). 
% By assuming the galaxies being collisionless in simulated merging clusters,
% \cite{Randall2008d} was the first to use the simulated offset of the DM population 
% from the member galaxies can provide estimates of $\offset_{\SIDM}$. 
By comparing the simulated offsets to the offsets of 25 $\pm$ 29 kpc from 
the observations of the Bullet Cluster
(\citealt{Markevitch2004} and \citealt{Bradac2006b}),
\cite{Randall2008d} were able to derive a constraint of $\sigmaSIDM <$ 
1.25 cm$^2$ g$^{-1}$.  

While similar staged simulations provide suitable settings 
for understanding of the physical origin and statistical distribution of $\offset_{\SIDM}$
for merging galaxy clusters, 
we argue that the simulated offsets should not be interpreted as the observed
offsets $\Delta s_{\rm obs}$.
If we assume (statistical) independence of 
the different possible contributions of the observed 
offset, we can decompose the model of $\Delta s_{\rm obs}$ to be:
\begin{equation}
	\offset_{\rm obs} = \offset_{\SIDM} + n + \cdots,
	\label{eq:signal_and_noise}
\end{equation}
with $\offset_{\SIDM}$ being the offset distribution caused by SIDM, 
and $n$ being the distribution of observational uncertainties and statistical noise.
We do not exclude the possibility of other contributions to the observed
offsets from other physical causes so we represent those terms with ``$\cdots$".
% Also, each of the terms in eq. \ref{eq:signal_and_noise} are two-dimensional
% (2D) vector quantities. 
These staged merger simulations give estimates of 
the distribution of the $\offset_{\SIDM}$ term, with
a highly suppressed $n$ term. 
  
There are various settings that the staged merger simulations put in place to maximize
$\offset_{\SIDM}$ and minimize the noise $n$. 
We list the assumptions from the staged merger simulations as follows: 
First, the physical properties of the galaxy
clusters are known to much higher certainty than possible as they are
controllable aspects of the simulations. e.g. both the DM and 
galaxies were initialized to follow a parametric spatial 
distribution   
(\citealt{Randall2008d}, \citealt{Kahlhoefer14}, \citealt{Robertson2016}, Kim
et al. in prep.), 
such as a Navarro-Frenk-White (NFW) profile. For real observations,
substructures and foreground
contaminations can all make the inference of the spatial distribution 
of the galaxy population more uncertain. 
Second, at the beginning of the simulated mergers, the galaxy and the DM
population are set to have zero offsets for any $\sigmaSIDM$ value. 
This assures that the offsets obtained from the merger simulations are due to SIDM. 
While this initial condition 
is a reasonable choice for making the effects of SIDM stand out from the simulations, 
the real $\offset$ of a cluster does not have to be zero at the 
beginning of a merger. We call this the intrinsic offset $\offset_{\rm
intrinsic}$.
Third, these staged merger simulations commonly use a much higher number of 
galaxies than is observable. \cite{Randall2008d} used
$10^5$ galaxies, \cite{Kahlhoefer14} used as many galaxy proxies as DM particles, 
while Kim et al. (in prep.) used either 5.7k or 57k galaxies. 
Fourth, the mergers are usually initialized with conditions that maximize SIDM
interaction rates, such as a zero impact parameter. However, the impact
parameter in any given observed merger is highly uncertain. 
Fifth, physical processes such as feedback from Active
Galactic Nuclei (AGN) are also sometimes ignored in these simulations. 
AGN feedback can affect the spatial distributions between the BCG and  
the DM peak \citep{Cui2015}. This effect can increase percentage of large 
BCG offsets in the tail region of the distribution and can affect what observed offset can be 
considered as a statistically significant deviation from the CDM model based on the p-value. 


% Most importantly, we argue that the estimated $\offset$ 
% from the staged simulations cannot be
% {\it directly}
% compared to $\offset_{\rm obs}$ of most clusters due to the following reason --- 
% the simulations have shown that for the staged cluster mergers under a CDM model,
% \\
% 1) the offset from other physical effects $\offset_{\rm dyn}$ over time 
% is both constant and negligible, 
% and \\ 
% 2) the noise term is approximately zero.\\ 
% While these conditions may apply for specific clusters that were being studied,
% they may not apply in general. 
% % For instance, \cite{Randall2008d} reported the offset from their CDM simulation 
% % as a constant number, i.e. $\sim 1.8$ kpc. 
% % Both \cite{Robertson2016} and
% % \cite{Kahlhoefer14} also showed approximately zero $\offset$ throughout their CDM 
% % simulation runs.   
% Again, these settings from staged simulations facilitate the estimation
% of $\offset_\SIDM$, which is an important step of understanding
% $\offset_{\rm obs}$. However, it is unclear that these settings with $n \approx
% 0$ hold for a CDM model with  
% realistic cluster substructures and galaxy spatial distributions, 
% non-negligible impact parameters and physical feedback.
 
When the staged simulations set $\sigmaSIDM$ to observationally motivated 
levels of $< 3$ \centi\meter$^2 / \gram$, 
different simulations have consistently reported the maximum SIDM offset 
signals ($\lesssim 50$ kpc) a few times smaller than the observed offsets 
($ > 200$ kpc). 
When \cite{Kahlhoefer14} simulated SIDM with both low-momentum-transfer 
self-interaction 
and rare self-interactions of DM with high momentum transfer, they found maximum 
offsets that are $< 30$ kpc for $\sigmaSIDM$ as high as 1.6 \centi\meter$^2$ / \gram.
The reported offset from \cite{Randall2008d}
for $\sigmaSIDM = 1.24~\centi\meter^2 / \gram$ is only 53.9 kpc. 
Other newer simulations also reach similar conclusions.
Kim et al. (in prep.) found a maximum offset $< 50$ kpc for 
$\sigmaSIDM = 3~\centi\meter^2 / \gram$, while
\cite{Robertson2016} found a maximum offset $\lesssim 40$ kpc  
 from a simulation suite of a Bullet Cluster analog 
 with $\sigmaSIDM = 1~\centi\meter^2 /$ \gram.
To match the observed offset values of $\sim 100$ kpc, it is possible 
to increase $\sigmaSIDM$ further. However, such big $\sigmaSIDM$ values will
cause a large rate of halo evaporation (Kim et al. in prep), which is not seen
in observations.
With the discrepancies of maximum $\offset$ values inferred between simulations 
and observations,
these simulations have raised questions other possible contributions to the
observed offsets.  

On the observational side, the list of observed merging galaxy 
clusters has been growing.
The majority of these studies reported non-zero,
but statistically {\it in}significant offsets, including the Musketball cluster
\citep{Dawson2013}, MACSJ1752 \citep{Jee2015}, 
and others that we list in more detail in Table \ref{tab:offset_results}.
Without understanding the various contributions of the noise term, 
we should not attribute all the offset to an SIDM signal. 

An alternative explanation for the observed level of galaxy-DM offset is due to 
statistical and observational uncertainties. Galaxies are
sparse samples of the underlying DM overdensities --- it is possible that the 
summary statistics of the sparse sample are different from those of the 
underlying distribution. 
% There has not been many investigation dedicated to examining: 
%  1) the offset from other physical effects  
%  and \\ 
%  2) the observational noise and statistical uncertainties .\\ 
It is not clear if there is any physical
origin of the galaxy-DM offset in a CDM universe, 
but any statistical noise leading to an offset can influence this method of 
inferring $\sigmaSIDM$. 

To bridge the gap between observations and staged simulations, we
study $n_{\rm CDM}$ from a cosmological simulation, the Illustris simulation
(\citealt{Vogelsberger2014}, \citealt{Genel2014a}). 
The Illustris simulation contains a sample of galaxy clusters that are evolved
from initial conditions similar to the primordial
matter density field. In section \ref{sec:illustris_sim},
we will show that the galaxy clusters from the Illustris simulation 
are realistic enough to examine some of the aforementioned assumptions made by the
staged simulations of galaxy clusters. Since the Illustris simulation assumes no SIDM but 
includes other physical effects and statistical noise, 
this study is complementary to the 
staged simulations for understanding $n$ and $\offset_{\rm intrinsic}$. 

Additionally, we propose a hypothesis test with the galaxy-DM offsets in
the Illustris simulation directly corresponding to our null hypothesis
$\mathcal{H}_0$, with: 
\begin{equation}
\begin{cases}
	\text{the null hypothesis }\mathcal{H}_0: \text{Cold Dark Matter (CDM)} \\
	\text{the alternative hypothesis }\mathcal{H}_1: \text{Self-interacting Dark
	Matter (SIDM)} 
\end{cases}
\end{equation}
and we try to see if the observed offset data can be compatible with offsets
derived from a CDM simulation. 

% This is the first study to compare the magnitude of SIDM offset signal with
% statistical noise, such as projection effects and unknown dynamical history. 
% These latent variables are confounding and can increase the variance of
% the population distribution of the galaxy-DM offsets.  

This exercise is further complicated by the fact that there is no theoretical
foundation showing which observable would be the most sensitive to each
possible type of SIDM. In fact, \cite{Kahlhoefer14} have argued that SIDM 
does not cause
significant offsets between the galaxy and DM peaks, and only leads to an offset
between the corresponding centroids within the dynamical timescale for
relaxation ($\sim$ several Gyr). 
% To access if the offsets we observe is
% completely explained by the method for computing the offset, we investigate   
% the precision to which we can find the galaxy-DM offsets.  
Popular methods for computing the offsets are shown in eq. \ref{eq:offset}.
They involve first inferring ${\bf s}_{\rm DM}$ 
and ${\bf s}_{\rm gal}$ independently before taking a difference.
While the inference procedures of ${\bf s}_{\rm DM}$ are driven by lensing 
physics, there is no standard procedure for
summarizing the sparse member galaxy distribution. 
We try to quantify the bias and uncertainty associated with the
statistic for summarizing the member galaxy population. 

Understanding the characteristics of different galaxy
summary statistics of clusters is also important for  
probing the matter fluctuations in the universe. 
One such type of study is done by performing lensing analyses on the stacked images of 
many small galaxy groups and clusters. 
The derived cluster mass function can provide constraints to cosmological
parameters such as $\sigma_8$ \citep{George2012a}. 
For such studies, stacking on the `wrong' centers or miscentering, is a commonly cited
source of uncertainties (\citealt{Johnston2007b},
\citealt{Ford2014}). By comparing the discrepancies of different galaxy
summary statistics, we can possibly determine the  
cause(s) of miscentering and ways to maximize the stacked signal. 

In this paper, we 
1) extract realistic observables from the Illustris simulation for
comparison with observations, 2) explore the pros and cons of various statistics for 
summarizing {\it the member galaxy population} of a galaxy cluster, and 3)	
give estimates for the offsets between the summary statistics of the galaxy  
population and the DM population under $\Lambda$CDM cosmology.
This gives an estimate of the baseline scatter of offsets without any SIDM.
This baseline scatter can be due
to both the observational noise and uncertainty $n$ and also the intrinsic offsets 
$\offset_{\rm intrinsic}$. We call this combined offset contribution:
\begin{equation}
	n_{\rm CDM} = n + \offset_{\rm intrinsic}
\end{equation}

And finally we 
4) examine the properties of the clusters that give outliers in 
the offset distribution and 5) investigate the  
correlations between the physical properties of a cluster and the projected 
observables such as $\Delta s$. 
\begin{figure*}
	\includegraphics[width=\linewidth]{fig1_mass_richness.eps}
	\caption{ {\bf Left figure:} Mass distribution of the group / cluster sized 
		DM halos for different halo selection schemes. Mass estimates obtained by the
		FoF algorithm are labeled as  M$_{\text{FoF}}$.
		We use M$_{200c}$ and M$_{500c}$ to represent 
		masses that are centered on the most bound particle within $R_{200C}$ and
		$R_{500C}$ respectively. The  
		average densities within $R_{200C}$ and $R_{500C}$ are 
		200 or 500 times the critical density of the universe. 
		% Huge discrepancies between the $M_{500c}$ and $M_{\rm FoF}$ of the clusters 
		% indicate the presence of spatially
		% separated substructures for the clusters (See Fig. 
		% \ref{fig:select_peak_visualization}). 
		{\bf Right figure:} 
		Mass-richness relationship of galaxy clusters and groups with 
		$M_{\rm FoF} > 10^{13} M_{\odot}$ assuming different cosmological redshifts
		of the observed clusters. 
\label{fig:mass_richness}}
\end{figure*}

% Basic setup 
The organization of this \ifthenelse{\boolean{thesis}}{chapter}{paper} is as follows:
In Section \ref{sec:illustris_sim}, we will describe the physical properties of 
the data of the Illustris
simulation, 
and the selection criteria that we have employed to ensure that the
quantities that we examine resemble observables but without noise and
systematics from observations. 
Then in Section \ref{sec:methods}, 
we explain the methods for computing various 
summary statistics of the spatial distribution of galaxies and how we prepare our dark
matter spatial data to resemble convergence maps. We show the statistical performance
of the different summary statistics before we show the main results
in Section \ref{sec:results}. In the discussion in Section \ref{sec:discussion}, 
we list the implications of our
results and compare it to other simulations and observations. We also 
show how one may make use of the population offset statistical distribution
from the Illustris data to construct a test with 
a null hypothesis of $\sigmaSIDM = 0$ and discuss the caveats. 

	Our analysis makes use of the same flat Lambda Cold Dark Matter ($\Lambda$CDM) cosmology
as the Illustris simulation. The relevant cosmological parameters are
$\Omega_\Lambda = 0.7274, \Omega_m = 0.2726$, $H_0 = 70.4$
km~s$^{-1}$~Mpc$^{-1}$, and $\sigma_8 = 0.809$.

\section{The Illustris simulation data} 
\label{sec:illustris_sim}
The Illustris simulation contains some of the most
realistic simulated galaxies in clusters to date, making it especially suitable for 
verifying the properties of galaxy clusters. We obtained our data from 
snapshot number 135 (cosmological $z=0$) of the Illustris-1 simulation. 
Among the different Illustris simulation suites,
the Illustris-1 simulation has the highest particle resolution. 
The sophisticated baryonic physics model in Illustris-1 
includes star formation and the environmental effects of the intracluster medium, 
such as ram pressure stripping,
strangulation and feedback from AGN etc. \citep{Genel2014a}.
The stellar physics were modeled using a moving mesh code {\sc{AREPO}} \citep{Springel2010}.
The observable properties of galaxies were verified to be statistically consistent
with the Sloan Digital Sky Survey (SDSS) data \citep{Vogelsberger2014}. 

As the stellar populations in Illustris were evolved from the initial condition,
these makes the spatial distribution of galaxies in the Illustris data more 
realistic than galaxies that are prescribed onto DM-only cosmological
simulation data such as those used in \cite{Harvey2013d}.  
Gravitational effects in Illustris-1 have provided realistic dynamics and
spatial distribution of subhalos. The simulated effects include
tidal stripping, dynamical friction and merging. 
Since the profiles of the galaxies clusters were not
provided in symmetrical, parametric forms, we can study 
how asymmetry in the cluster profile affects the estimate of our summary 
statistic. This data allows us to examine cluster galaxies
under the most ideal observational conditions. 
The softening length of the DM particles is
1.4 kpc and those of the stellar particles is 
0.7 kpc, both in constant comoving units \citep{Genel2014a}.

The two sets of data catalogs in use are obtained through two types of halo
finders. The catalog that maps particles to the halo of a certain cluster was 
created by the {\sc{SUBFIND}} algorithm. The friends-of-friends (FoF) 
finder \citep{Davis1985} was further used to identify the affinity
of galaxy-sized halos to a galaxy-cluster. 
These galaxy-size halos are referred to as {\it subhalos} and 
they are the dark matter hosts of what we refer to as galaxies in Illustris-1. 
\cite{Vogelsberger2014a} also extracted the 
absolute magnitude (using AB magnitude) of each subhalo in
the SDSS bands of $g, r, i, z$ as part of the {\sc
SUBFIND} catalog using stellar population synthesis models.

For our analyses, we make use of galaxy clusters / groups 
with at least 50 member galaxies that are within a reasonable observational limit, 
i.e. apparent $i \leq 24.4$ which is feasible for spectroscopic confirmation with the DEIMOS
spectrometer on the Keck telescope when we assume a cosmological redshift of $z = 0.3$
in the $i$ band. % This represents a spectroscopic selection of member galaxies. 
% The limiting magnitude of 24.2 in the
% F814W filter of the Hubble Space Telescope, and the limiting magnitude of the
% Canadian-Hawaii French Telescope of 24.5, 
% are also close to our chosen limiting magnitude. 
There is relatively large statistical uncertainty if we try
to analyze groups with less than 50 member galaxies. 
As indicated by the right-hand panel of Fig. \ref{fig:mass_richness}, 
a total of 43 clusters has 
survived this magnitude cut. These simulated galaxy clusters (or groups) have 
masses ranging from $10^{13}$ M$_\odot $ to $10^{14}$ M$_\odot$.  

\begin{figure}
	\centering
	\includegraphics[width=\linewidth]{fig2_color_magnitude_diagram9.eps}
	\caption{Color-magnitude diagram of one of the galaxy clusters that is selected for 
		analysis. This cluster is the 9th most massive. 
		The apparent magnitude is calculated assuming that 
		the cosmological redshift is $z = 0.3$. 
		We can see a clear overdense region that corresponds to a red-sequence.
		Note that the lack of foreground / background galaxies results in a smaller
		range of colors than seen in most observed color-magnitude diagrams.	
		The color-magnitude diagrams of the other clusters can be found in the
		Jupyter notebook at \href{https://github.com/karenyyng/galaxy_DM_offset/blob/master/code/analyses/fig2_color_magnitude_diagram.ipynb}{https://goo.gl/TJmI6s}.
		\label{fig:color_magnitude_diagram}
	} 
\end{figure}


\subsection{Cluster properties}
\label{subsec:cluster_properties}

\subsubsection{Quantifying the dynamical states (relaxedness) of the galaxy clusters}
\label{subsubsec:relaxedness}

Clusters undergo merger activities at a large range of physical scales and 
on time scales of millions of years. 
The dynamical history cannot be directly 
computed from observations. 

% put this in landscape mode if this is compiled for my thesis 
\ifthenelse{\boolean{thesis}}{\begin{landscape}}{}
\begin{table*}
\begin{center}
	\caption{ Selection criteria for stellar subhalos (member galaxies) for each
		cluster / group 
\label{tab:member_galaxy_selections}} 
  
\ifthenelse{\boolean{thesis}}{
	\resizebox{1.35\textwidth}{!}{
	\input{./Chapters/chapter3_table1}
	}
}{
	\input{./Chapters/chapter3_table1}
}
\end{center} 
\end{table*}
% put this in landscape mode if this is compiled for my thesis 
\ifthenelse{\boolean{thesis}}{\end{landscape}}{}
We use several measures of unrelaxedness to characterize 
the dynamical state of the clusters and see how they correlate with $\Delta s$.
Some possible definitions of unrelaxedness used by the simulation community
include:
\begin{itemize}
	\item unrelaxedness$_0$: the ratio of mass outside the dominant dark matter halo over the total mass
		of the galaxy cluster. The lower the ratio, the fewer substructures there
		are in the cluster. 
	\item unrelaxedness$_1$: the distance from the most bound particle to
		the center of mass in terms of R$_{200c}$, the three-dimensional (3D) radius in which the
		average density is 200 times the critical density of the universe. 
		The smaller the distance, the lower the unrelaxedness. 
\end{itemize}
To relate these simulation quantities to observation, 
we compute more observation-oriented 
quantities in the method section (Section \ref{subsubsec:nu}). 

\subsection{Selection of the field-of-view}
\label{sec:FOV}


We used {\sc{SUBFIND}} for member particle identification of the DM and the 
{\sc{FoF}} finder for subhalo identification.
This unrestricted field of view ($\gtrsim 1$ Mpc per side) for our simulated data can be much bigger than
the field of view reported from Hubble Space Telescope 
observations, e.g. $~200$ kpc per side \citep{Zitrin2012a}. We make use of this volume selection scheme
for baseline comparisons. Assuming $z = 0.3$, 
the projected extent for most of the Illustris galaxy clusters and groups
fits inside the field of view of different instruments, such as the Subaru Suprime Camera,
which covers a physical area of $\sim 9$ Mpc $\times 7$ Mpc at z = 0.3 
(see \href{https://goo.gl/ClZNvM}{https://goo.gl/ClZNvM} for a Jupyter notebook 
showing the extent of the DM distribution of the most massive 129
clusters). Furthermore, we ignore foreground / background structures.
This provides an unobstructed field-of-view that can be more ideal than most observations. 

\subsubsection{Spatial Projections}
\label{subsubsec:projections}
% Unlike in staged simulations, picking out a particular projection for a cluster 
% does not always make physical sense.
% However, for mergers or asymmetrical clusters, 
% there is no obvious choice for the plane of projection that can allow us to
% understand the cluster. Depending on the number of merging components, there
% may not be any simple merger axis that should be 
% projected along the plane of the field of view. 
In observations, we do not have any control over the line-of-sight that we view a
cluster from. 
We therefore compute observables based on even sampling of angular orientation 
as our line-of-sight.
As the order of projecting the data and estimating the summary statistic is
non-commutative, we first project the data before estimating any projected 
observable. 
We used {\sc HealPy},
which is a {\sc Python} wrapper for
{\sc{HEALPix}}\footnote{HEALPix is
currently hosted at http://healpix.sourceforge.net}
\citep{Gorski2005}, to compute the angular projections. {\sc HealPy} gives different
lines-of-sight, each centered on a {\sc{HEALPix}}
pixel. Each pixel covers the same amount of area on a sphere. 
The number of projections that we employed is 768 for each cluster. With this
many projections, the offset distributions of each cluster start to converge to a
stable distribution. 
Even though there are at least 2 identical projections for each cluster due to
one possible line-of-sight from the front and one from the back, it does not
affect any summary statistic. We do not remove the duplication as it breaks
the rotational symmetry in the 2D plane when we compute the 2D population
distribution of offsets.  
% Details of the implementation of the projection is available in Appendix
% \ref{app:projections}.


\subsection{Properties of the galaxies in Illustris clusters}
\label{subsec:galaxy_properties}

Different galaxies have different masses, so they should not be considered with equal
importance for peak identification, we will show empircally that uniform
weights yield larger galaxy-DM discrepancies. One of the most common weighting schemes employed for galaxy data is to weight
by the luminosity in a particular band. For some of the methods, we investigate
the differences in peak identification with and without any luminosity weights.
We pick the $i-$band magnitude
associated with each subhalo as the weight. Since the $i-$band is
one of the redder bands, the mass-to-light ratio is not skewed as much due to star
formation activities. 

We further examined if the color distribution of galaxies in Illustris-1 are
similar to the observed color-magnitude diagrams for clusters.
Fig. \ref{fig:color_magnitude_diagram} shows the $r-i$ vs $i$ color-magnitude
diagram for the galaxy clusters in Illustris-1.
It clearly reveals an overdense region of galaxies known as the red-sequence in the 
color-magnitude diagram. The red-sequence is prominent even if we
use other colors formed by different combinations of the $r, i, z$ bands.

\section{Methods}\label{sec:methods}
A common way of summarizing the DM distribution in a
galaxy cluster is by finding the lensing peaks.
(\citealt{Medezinski2013}, \citealt{Markevitch2004}, 
\citealt{Zitrin13}). 
Additionally, the peak region is physically 
interesting due to the higher particle density and interaction rates. 
The most direct analogous statistic for summarizing the member galaxy
population in a cluster is therefore also the peak. 
Comparing the DM peak with the summary statistics of the galaxy population that
are not the peak  can have an {\it offset} purely due to the difference in
the choice of the statistic. 
We will state the definition and implementation of the five commonly used 
point statistics or locations for summarizing 
the member galaxy population in a galaxy cluster.

We avoid any manual methods for
comparison purposes, as well as scalability and reproducibility. 
Since all the methods listed in this \ifthenelse{\boolean{thesis}}{chapter}{paper}
are automated with the source code openly available, 
it is possible for future studies to reuse our code for comparisons. 
% There are a number of decisions ($\sim $[TODO] ADD NUMBER) that one needs to make to 
% determine the summary statistics. We will try to address the sensitivity of the offset
% due to each decision. 
Another major advantage for automation is that it allows us  
to apply
the same methods across the different snapshots of the (Illustris) simulations to
examine the variability of $\Delta s$ across time in future studies. 


\subsection{Finding the galaxy summary statistic}
\subsubsection{Computing the weighted centroid}
\label{subsubsec:weighted_centroid}
We follow the usual definition of the weighted centroid: 
\begin{equation}
	\bar{\bf x}_w = \frac{\sum_i w_i \vec{x}_i}{\sum_i w_i},
\end{equation}
with $\vec{x}_i$ being the positional vector of each subhalo 
and we use the $i$-band luminosity 
as the weight $w_i$ for the $i$-th galaxy.
Centroids can be biased by subcomponents from merging activities. 
These estimates are also sensitive to odd boundaries 
of the field of view.

\subsubsection{Cross-validated Kernel Density Estimation (KDE) and the peak finder} 
\label{subsubsec:KDE}
Finding the exact peak of a set of data points 
involves computing the density estimate of the data points and sorting through
the density estimates. A specific version of this density estimation process is
known as histogramming. During the making of a histogram, each data point is
given some weight using a tophat kernel and the weights are summed up at
specific data locations (e.g. $\bf{x}_i$). 
A histogram is not good for peak estimate for {\it sparse} data for two reasons: 1) the
choice of laying down the bin boundaries affects the count in each bin, 2) the choice of
bin width also affects the count in the bin. Only when the available number of data points
for binning is large are the estimates of histograms and smoothed density
estimates approximately the same. The number density of member galaxies  
is sparse enough ($< 500$) for the uncertainty introduced by histogramming 
to bias our peak estimate. We therefore perform a kernel density estimation
instead of histogramming. 
For the density estimate of galaxy luminosity, 
we adopt a Gaussian kernel. 
The exact choice of the functional form of the smoothing kernel does
not dominate the density estimate as long as the chosen kernel is
smooth \citep{Feigelson2014}. 

For computing the density estimate, the most important parameter  
is the bandwidth of the smoothing kernel, 
which takes the form of a matrix in the 2D case. 
%  We illustrate the choice of kernel width with Fig.
% \ref{fig:bias_variance_tradeoff}. 
When the kernel width is
too large, the data is over-smoothed, 
resulting in a bias of the peak estimate. On the other hand, when the kernel
width is too small, it results in high variances of the estimate and 
too many peaks due to noise. 
The parameter decision for balancing between the portion of
bias or variance in an estimate is also known as the bias-variance tradeoff. 
A good illustration can be seen in \citealt{Vanderplas2012} from 
\href{http://www.astroml.org/book\_figures/chapter6/fig\_hist\_to\_kernel.html}{http://goo.gl/jvsfcv}.
All other smoothing procedures, including interpolation with splines,
polynomials, and filter convolutions, also face the same tradeoff. 

A well-known way to minimize the fitting error from the density estimate is through
a data-based approach called cross-validation to obtain 
the optimal 2D smoothing
bandwidth matrix ($\Hmat$) of the 2D Gaussian kernel for the
density estimate $\hat{f}$:
\begin{align}
	\hat{f}(\chi; \Hmat) &= \frac{1}{n} \frac{1}{(2\pi)^{d/2}|\Hmat|^{1/2}}
	\sum_{i=1}^n w_i \exp((\chi-{\bf x}_i)^T H^{-1} (\chi-{\bf x}_i)),
	\label{eq:cross_validated_bandwidth}
\end{align}
where the dimensionality is $d=2$ for our projected quantities,
$\chi$ represents the uniform grid points for evaluation, and 
$\bf{x}_i$ contains the spatial coordinates for each of the identified member 
galaxies that survived our brightness cut and $w_i$ is again the $i-$band
luminosity weights for each galaxy.
The idea behind cross-validation is to leave a small fraction of data points 
out as the test set, and use the rest of the data points as 
the training set for computing the estimated density.
Then it is possible to estimate and minimize the Asymptotic Mean-Integrated Squared Error
(AMISE)  by searching
for the best set of bandwidth matrix values, eliminating any free parameter. 

Specifically, we made use of the smoothed-cross validation \citep{Hall1992} 
bandwidth selector in the statistical package {\sc{ks}} \citep{Duong2007} 
in the {\sc{R}} statistical computing environment \citep{R_core}. 
Among all the different {\sc{R}} packages, {\sc{ks}} is the
only package capable of handling the magnitude weights of the data points 
while inferring the density estimates \citep{Deng2011}. 
Although this particular implementation of KDE has a computational runtime of $O(n^2)$, 
the number of cluster galaxies is
small enough for this method to finish quickly ($\lesssim 0.65$ second per
projection per cluster). 

The resulting KDE contains rich information about the spatial distribution of
the clusters, and we focus on the peak regions.  
We employed both a first and second-order  
finite differencing algorithm to find the local maxima.  
The local maxima were then sorted according to the KDE density in a descending
fashion before we perform peak matching and compute the offset. The exact
procedure is discussed in section \ref{subsec:offsets}. 

\subsubsection{Characterizing the dynamical states using the number of cluster
luminosity peaks}
\label{subsubsec:nu}
For each projection of each cluster, we normalize the density of all 
luminosity peaks to those of the brightest peak. 
Luminosity peaks that sit on top of actual subclusters would then have a density 
comparable to those of the brightest peak. 
Then we sum the density of all the galaxy peaks for a cluster and call this value
$\nu$. When the value of $\nu$ much gets bigger than 1, it indicates the presence 
of projected substructure(s). Even though 
$\nu$ is not expressed in terms of masses, it can be computed using galaxy
magnitudes from optical survey data. 
% Another possible quantification of relaxedness can be computed based on the
% (morphology) ratio of eigenvalues of the galaxy luminosity map bandwidth matrix. 

\subsubsection{Shrinking aperture estimates}

Another popular method among astronomers for finding the peak of a spatial
distribution is what we call the shrinking aperture method, which iteratively
computes the centroid over successively smaller apertures.
We test if the shrinking aperture method is able to reliably recover the 
peak of the luminosity map.
This method is dependent on the initial diameter and the initial center 
location of the aperture, and 
 does not evaluate if the cluster is made up of
several components.
The estimate using the shrinking aperture algorithm can be biased by
substructures. The only way to inform the algorithm about substructures would
be to introduce another parameter to restrict the extent of the aperture, or to
partition the data with another (statistical) algorithm.
More to the point, the convergence of results of this method is not guaranteed. We use a
convergence criterion of having the aperture distance not change more than 2\% 
between successive iterations as a reference. The actual implementation in
{\sc Python} can be found at \href{https://goo.gl/nqxJl8}{https://goo.gl/nqxJl8} while
the pseudo-code can be found in Appendix \ref{app:shrink_apert}.

\subsubsection{Brightest Cluster Galaxies (BCG)}
The BCGs are formed by the merger of many smaller
galaxies. However, star formation can cause
less massive galaxies to be brighter in the bluer photometric bands.
To avoid star formation from biasing our algorithm for identifying the
BCG, we find the brightest galaxies in redder bands i.e. the $r, i, z$
bands and found that they give consistent results for all selected clusters. 
We used the $i-$band to pick the BCG for computing the plots and the final results. 
 
\begin{figure*}
	\centering
	\includegraphics[width=.85\linewidth]{fig3_toy_data_mixtures.png}
	\caption{Comparison of peak finding performances of the shrinking aperture
		peak (shrink peak), dominant peak estimate from the KDE map (KDE1), and the centroid (cent), by
		drawing data points (i.e. 20, 50, 100, 500) from a known number of 
		Gaussian mixtures. 
		Panels from the top row contain data drawn from a single Gaussian mixture. The
		panels from the middle row contain data from two 
		 Gaussian mixtures with weight ratio = 7:3. 
	The panels from the bottom row contain data drawn from three Gaussian
	mixtures with weight ratio = 55:35:10. 
	The left column shows a realization of 50 data points drawn from the Gaussian
	mixture(s). A zoomed-in view of the data as shown by the
	boxes with dashed-outlines are present in the middle
	column.
	Due to the statistical nature of this exercise, we sampled the data and
	performed the analyses 1000 times to
	create the 68\% and 95\% Monte Carlo confidence contours of the estimates in the
	middle column. The rightmost column shows how the population bias varies as a
	function of the number of drawn data points from the Gaussian mixtures. 
	From the middle and the rightmost
	column, we can tell that the cross-validated KDE peak estimate is the most 
	accurate when
	there is more than one significant component and enough data points ($> 50$).  
		\label{fig:toy_data_mixtures}}
\end{figure*}

\begin{figure*}
	\begin{center}
	
	% put this in landscape mode if this is compiled for my thesis 
	\ifthenelse{\NOT
		\boolean{thesis}}{\includegraphics[width=0.8\linewidth]{Fig4_clst1_48_225.png}}{}
	\includegraphics[width=0.8\linewidth]{Fig4_clst1_48_135.png}
	\includegraphics[width=0.8\linewidth]{Fig4_clst12_48_135.png}
	\caption{Visualization of clusters (each row is for the same projection
		of the same cluster). Left column: Projected density distribution of DM	
		particle data is shown in orange, with the dense regions in yellow. 
	The identified DM density peaks are indicated by colored circles. 
		Middle column: The same DM projection after smoothing with a 50 
		kpc smoothing kernel.
		Right column: Projected galaxy kernel density estimates (KDE) of 
		the $i$-band luminosity map for the member
		galaxies of the same clusters. Each colored contour denotes a 10\% drop 
		in density starting from the highest level in red. Each magenta ellipse on the
		bottom right corner of the panels shows the Gaussian kernel matrix 
		$H$ from eq. (\ref{eq:cross_validated_bandwidth}). 
		The big black 
	circle is centered on the most bound particle identified by {
		\sc SUBFIND } and the radius of the circle indicates the 
		R$_{\rm 200C}$. The luminosity peaks (square markers) are colored
		by the relative density to the densest peak (aka $\nu$ as discussed in
		section \ref{subsubsec:KDE}). The color bar shows the relative density value. 
		% The top two rows are the different projections of the same cluster (ID 1).
		See \href{http://goo.gl/WiDijQ}{http://goo.gl/WiDijQ} 
		and \href{http://goo.gl/89edcM}{http://goo.gl/89edcM} for the 
	visualization of the selected clusters inside two Jupyter notebooks.
		\label{fig:select_peak_visualization}
	}
\end{center}
\end{figure*}

\subsection{Comparison of the methods using Gaussian mixture data}
In order to examine the statistical properties of commonly used point-estimates 
of the distribution of the galaxy data, we test them on data drawn 
from Gaussian mixtures with known mean and variance. 
(See Fig.
\ref{fig:toy_data_mixtures}). 
The main factors that affect the performance of 
the methods are due to the statistical properties of the data, 
including 1) the density profile and 2) the
location(s) of subdominant mixtures, and 3) the number of data points that we draw.
Due to statistical fluctuations, it is also not enough to
compare the performance by applying each method for just one realization of the
data. We provide the 68\% and the 95\% confidence regions by applying the
each method for 1000 realizations from the Gaussian mixtures.
We compute the population location from the 1000 realizations for each method 
and indicate it as a cross on the middle column of Fig. \ref{fig:toy_data_mixtures}.
The difference between this population estimate and the peak of the dominant mixture 
is shown as the bias on the right hand column of Fig.
\ref{fig:toy_data_mixtures}.
In general, the peak identified from the KDE density is closer to the 
peak of the dominant mixture (more accurate) than 
both the weighted centroid method and the shrinking aperture method.
For example, in the bottom middle panel of Fig. \ref{fig:toy_data_mixtures}, 
the green contours
that represent the confidence region for the shrinking aperture peak are
biased due to the substructure, whereas the confidence region for the centroid 
is so biased that it is outside the field of view of that panel.
In the right panel of Fig. \ref{fig:toy_data_mixtures}, 
we present how the population bias of each method shrinks as the
number of data points increases. With enough data points ($> 50$), 
for the data generated with more than one mixture, 
the KDE peak consistently shows less population bias than the shrinking aperture method. 
The performance of the shrinking aperture method fluctuates and is unstable when
the number of data points is increased.

\subsection{Modeling the DM map in Illustris-1 and the lensing kernel}
\label{subsec:DM_map}
The most well established method of inferring the projected dark matter spatial 
distribution from observations is through gravitational lensing.
It works by detecting subtle image distortions of background galaxies due to
the foreground dark matter. The resolution of the inferred map therefore 
depends on the properties of the source galaxies that are being lensed, 
such as the projected number density, the intrinsic ellipticities and morphology etc.
\cite{Hoag2016} has performed a simulation for inferring the optimal bandwidth
for a Gaussian smoothing kernel for the cluster MACSJ0416. 
In the strong lensing regime, \cite{Hoag2016} found a resolution of 11 arcseconds
can best fit the MACSJ0416 data. A kernel bandwidth (this is the standard deviation) 
of 11 arcseconds translates to an angular diameter distance of 50 
kpc assuming a cosmological redshift of $z \approx 0.3$. 
In order to match the resolution of lensing data,
we also employed a smoothing kernel of a similar physical size of 50 kpc.  
It should be noted that this is one of the best-studied clusters, 
with many strong lensing constraints. 
A cluster without strong lensing constraints will be mapped with 
lower resolution.

To compute the DM spatial distribution from our data, we first make a histogram with 2 kpc
$\times$ 2 kpc bin size which is slightly larger than the DM softening length of 1.4 kpc. 
After that, we use a (50, 50) kpc 2D radial Gaussian kernel 
to smooth the DM histogram made from the Illustris DM
particle data. 
There are resolution differences between the smoothed and unsmoothed DM
maps. The unsmoothed histograms tend to show many more local maxima around the major
density peaks (i.e. show high variance). 
The number of DM particles for each cluster is of 
the order of millions and densely packed in the region of
interest. 
Physically, the smoothed histograms of the dark matter of each cluster 
is analogous to a convergence map from a high-resolution lensing analysis. 


\subsection{Finding the offsets} \label{subsec:offsets}
Finding the offsets between the peaks of the DM map and the peaks of the 
luminosity map is not a well-defined process in the presence of multiple peaks. 
Different peak identification criteria and matching
procedures can lead to different offset values. 
We refer the readers to Fig. \ref{fig:select_peak_visualization} for a comparison
between the DM maps (e.g. the left and middle columns), and 
the KDE of the luminosity maps (the right column).
Each row of Fig. \ref{fig:select_peak_visualization} corresponds to the maps of
the same cluster projection.
There can be multiple peaks in each map due to substructures. 
There are also many more DM peaks (indicated by circles on the left two columns) 
than luminosity peaks (indicated by the squared markers on the right column).
This is because there are many more dark subhalos than galaxies for each cluster and 
the resolution of the DM data is much higher. 

Furthermore, due to projection, not all peaks correspond to actual substructures.
We try to determine the importance of the peaks according to the density 
estimates at each luminosity peak. For the convenience of the readers, 
in the right hand panels of Fig. \ref{fig:select_peak_visualization},
we have indicated the density estimate of the luminosity peaks 
by the color of the squared markers. 
The color bar shows the color mapping to the density estimate.
The density estimate at each peak ($\nu$) is normalized according to the density
estimate of the brightest peak of each cluster projection. 
% We only match DM peaks to luminosity 
% peaks that are at least 20\% as dense as the brightest luminosity peak to avoid 
% computing the offsets of spurious substructures.
There are some spurious substructures as indicated by 
the deep blue squared markers in the right hand panels of Fig.
\ref{fig:select_peak_visualization}.
They represent peaks created by a small number of galaxies that
are located far away from the main concentration of mass.

We write our peak matching algorithm to mimic how humans would
find the closest DM peak to the galaxies peak. 
This peak-matching process (described in detail in the following paragraph) 
can be visualized in the middle column of 
Fig. \ref{fig:select_peak_visualization}.
From the computation of the KDE luminosity map,
we have used the KDE method from Section \ref{subsubsec:KDE} to compute 
the significant luminosity peaks locations. 
The luminosity peaks are indicated by the magenta circles in the middle column
of Fig. \ref{fig:select_peak_visualization}.
From Section \ref{subsec:DM_map}, we have also computed the DM peak locations, 
as indicated by the cyan or blue circles.

To find the closest match between the DM and luminosity peak, 
we compute the distances between the densest DM peaks
and the significant luminosity peaks (peaks with $\nu > 0.2$) 
using a data structure called a k-dimensional tree (KD-Tree; in
our case, k = 2). A tree stores the locations of the DM peaks in a sorted
manner and can speed up the identification of the closest DM peak from the
location of the luminosity peaks.
But we do not compute the distances
between all possible pairs of DM peaks and galaxy peaks.  
We only compute the distances of the most significant luminosity peak and 
the densest $n_{\rm DM}$ number of DM peaks. 
During the matching, we allow more DM peak
candidates for clusters that have subclusters indicated by
multiple significant luminosity peaks (peaks with $\nu > 0.2$):
\begin{equation}
	n_{\rm DM} = \begin{cases}		
		3 \times (n_{lum} + 1) & {\rm if~} n_{lum} < 3 \\
	3 \times n_{lum}  & {\rm if~} n_{lum} \geq 3.
	\end{cases}
	\label{eq:peak_threshold}
\end{equation}
where $n_{lum}$ is the number of significant luminosity peaks, and $n_{\rm DM}$
is the number of DM peaks that went into the construction of the KD-tree.
When there are several dense galaxy peaks located far away from one another, 
the top few densest DM peaks (subhalos) can locate around the same galaxy
peak (see the cyan circles in Fig. \ref{fig:select_peak_visualization} for the
third row), i.e. there is no one-to-one matching between the luminosity of 
galaxies and the density of detected DM peaks. 
Matching purely based on density and luminosity leads to larger offsets than if
we use eq. \ref{eq:peak_threshold}.
From the inspection of figures similar to 
Fig. \ref{fig:select_peak_visualization}, 
using eq. \ref{eq:peak_threshold} works well to match the 
appropriate peaks, i.e. the blue circle which indicates the matched DM peak 
in the left and middle columns 
often overlaps the magenta circle which is the luminosity peak.  

To prevent peak matching from affecting the offset results,
we will only use the offsets with the DM peak matched to the brightest
luminosity peak for the final results.
And we call this offset $\offset_{\rm KDE}'$, where $'$ indicates that the
luminosity weighted data was used to compute the offset. 
We show in the result section \ref{subsec:offset_from_most_bound_particle} 
that most of the chosen DM peaks
do not have significant deviation from the most gravitationally bound particles.
After identifying the DM peaks, we compute the 
offsets between the matched DM peaks, and the following spatial estimates, including 
\begin{itemize}
	\item the most (gravitationally) bound particle, 
	\item the shrinking aperture peaks, the corresponding offset is $\Delta s_{\rm
		shrink}'$, 
	\item the number density peaks, the corresponding offset is $\Delta s_{\rm
		num.dens}$, 
	\item the BCGs, the corresponding offset is $\Delta s_{\rm BCG}$ and
\item the luminosity weighted centroid, the corresponding offset is $\Delta
	s_{\rm cent}'$.
\end{itemize}
Since there can be more than one number density peak from the corresponding KDE
map, we also use a KD-tree to match the closest number density peak to the 
identified DM peak.
% The most bound particle is the location with minimum 
% gravitational potential of the {\sc{Subfind}} identified cluster.
% Due to substructures, it is possible for there to be several minima of similar 
% gravitational potential level. 

After matching the peaks to compute the offsets, 
we report the percentile for the offset distributions.
For instance, the 95\% interval is computed as the narrowest interval that encompasses
95\% of total density (2.5\% of density mass at each end of the tail is
excluded). In case of degeneracy, the interval is also required to cover the 
central location estimate for the distribution.
Additionally, we report other statistics of interest, such as the biweight 
location (analogous to the median)
and the midvariance (robust standard deviation
estimate) to minimize the effects of outliers \citep{Beers90}. 
We compute the robust statistics using the 
implementation of {\bf \texttt{astropy.stats.biweight\_location}}
and {\bf \texttt{astropy.stats.biweight\_midvariance}}
from \cite{astropy} as part of {\sc{astropy}}. 

\subsection{Constructing the hypothesis test} 
\label{subsec:hypothesis_test}
The representations of the distributions of $\Delta s$ carry
different information and allow different types of statistical tests. 
The most faithful representation of the offsets without any information loss
is:
\begin{equation}
	\Delta {\bf s} = ({\bf x}_{\rm gal} - {\bf x}_{\rm DM}, 
	{\bf y}_{\rm gal} - {\bf y}_{\rm DM} ).
	\label{eq:2D_offsets}
\end{equation}
The PDF of $\Delta {\bf s}$ in eq. \ref{eq:2D_offsets} peaks at (0, 0) when
there is no real offset. It is also possible to do directionality tests,
such as Rayleigh z test, to see if the data points have a preference to land in
a certain direction.
However, when one takes the magnitude of $\Delta {\bf s}$, i.e.:
\begin{equation}
	|\Delta {\bf s}| = \sqrt{({\bf x}_{\rm gal} - {\bf x}_{\rm DM})^2 + 
	({\bf y}_{\rm gal} - {\bf y}_{\rm DM})^2},
	\label{eq:magnitude_offsets}
\end{equation}
the resulting 1D distribution of $|\Delta {\bf s}|$, 
whose support being [0, $\infty$),
will not peak at zero even if the original
distribution of $\Delta {\bf s}$ peaks at (0, 0). 
To illustrate how difficult it is to interpret the magnitude values $|\Delta
s|$,  
we can imagine the following transformation.
The values drawn from a 2D standard Gaussian: 
\begin{equation}
	\left(\begin{array}{c}
			\bf{x}\\
			\bf{y}
		\end{array}
	\right) \sim \mathcal{N}\left(
	\left(
		\begin{array}{c}
			0 \\
			0
		\end{array}
	\right),
	\left(\begin{array}{cc}
		\sigma^2, 0 \\
		0, \sigma^2
	 \end{array}
	\right)
\right),
\end{equation}
will result in $|\Delta s|$ values that follow the Rayleigh distribution:
\begin{equation}
	f(\Delta s | \sigma) = \Delta s /  \sigma^2 \exp(-\Delta s^2 / 2 \sigma^2)
	\label{eq:rayleigh_distro}
\end{equation}
whose peak is at $|\Delta s| = \sigma$, the same standard deviation value of the 2D
Gaussian. Note that this representation in  
eq. \ref{eq:rayleigh_distro}
rules out any probability mass at $|\Delta s|$ = 0 by construction. 
The dependency of $|\Delta s|$ on the parameters of
the 2D distribution is even more
complicated when the the 2D distribution does not approximate a Gaussian 
or when there is more than one peak in the 2D space. 
The shifting of the peak location due to variable transformation 
is seen in the distribution of $|\Delta {\bf s}|$ recorded in Table
\ref{tab:offset_distributions}.
% For a non-parametrical, asymmetrical 1D distribution due to taking the magnitude,
% the resulting 1D distribution can have more than one peak. The multiple peaks
% can also be spread apart.  
% Finding the {\it narrowest} 68\% and 95\% interval
% for such an asymmetrical, multiply-peaked distribution is not a 
% well defined procedure and can be prone to error. 
% The 68\% or 95\% interval needs to
% span the smallest range of $|\Delta s|$ values to be used for a hypothesis test.
% Or else the conclusion of the hypothesis test 

On the other hand, 
the 1D distributions of offsets along a particular spatial axis, 
e.g. $\Delta {\bf x}$ and $\Delta {\bf y}$,
each with a support of $\mathbb{R}$, will not exhibit a discontinuity at zero.
Any shift or asymmetry in the 2D peak location is still obvious. 
The distributions represented by $\Delta x$ or $\Delta y$ 
can be symmetrical so 
the narrowest density interval (aka highest density interval) is easier to find.
We have therefore chosen to perform our hypothesis test using $\Delta y$
instead of $|\Delta s|$.
Since we have enough samples for there to be
rotational symmetry for the distribution of $(\Delta {\bf x}, \Delta {\bf y})$,
we will show that it does not
matter if we pick $\Delta {\bf x}$ or $\Delta {\bf y}$ for the 1D representation.
We compute the hypothesis test significance level with the 
 offset $\Delta {\bf x}$ along one of the spatial axes. 
To report the statistics, we also make use of estimates that do not make any
underlying assumption of the shape of the distributions that may skew the
statistical parameter estimate.
In fact, several studies have reported poor single 2D Gaussian fits to 2D offset data
due to the long tails
(\citealt{Zitrin2012a}, \citealt{Oguri2010}).  

In the following sections of this \ifthenelse{\boolean{thesis}}{chapter}{paper}, 
we use $\Delta {\bf s}$  to represent the
two-dimensional offsets, $|\Delta {\bf s}|$ for the magnitude of the offset as calculated
according to the Euclidean distance, and $\Delta x$ or $\Delta y$ to denote the
one-dimensional offset along one of the spatial dimensions.
To compare with observed data, we estimate the 1D spatial components of
the offsets from the merging cluster observations from various sources.   
We make our best attempt to measure $\Delta y_{\rm obs}$, the spatial component of the
observed offset along the axis connecting the subclusters if they exist. 
In our observed samples, Abell 3827 is the only exception that has no
subclusters but only four bright galaxy peaks in the central region. 
\ifthenelse{\boolean{thesis}}{\begin{landscape}}{}
\begin{figure*}
	\centering

	\ifthenelse{\boolean{thesis}}{
			\begin{minipage}[b]{0.6\textwidth}
	}{
			\begin{minipage}[b]{0.45\textwidth}
		}
	\includegraphics[width=0.85\linewidth]{fig8_total_normalized_peak_density.pdf}
	\end{minipage}
	\ifthenelse{\boolean{thesis}}{
			\begin{minipage}[b]{0.6\textwidth}
	}{
			\begin{minipage}[b]{0.45\textwidth}
		}
	\includegraphics[width=0.85\linewidth]{fig7_projected_KDE_offset_distribution.pdf}

	\end{minipage}

	\caption{Left: A box plot showing the distribution of the total normalized
		peak density ($\nu$)
		for each cluster. Clusters with only one dominant peak has $\nu = 1.0$,
		values bigger than 1 indicate  density fraction contributed by other
		peak(s). 
	  Right: A box plot showing the distribution of $\Delta y_{\rm KDE}$ for each cluster. 
		The distributions from both plots are based on 768 projections. 
		The offsets were computed between the closest DM 
		peak to the brightest luminosity peak of each cluster. 		
		The red line of each box shows the median of the projections,
		the box encompasses the 25\% and 75\% percentile of the distribution while
		the whiskers mark the 5\% and the 95\% percentile. The other black crosses
		are data points with extreme values beyond the 5\% and 95\% percentile.
		The median of $\nu$ show on the
		left and the max($\Delta y_{\rm KDE}$) values on right plot 
		show a correlation as high as 0.77.
		\label{fig:projected_KDE_offset_distribution} 
	}
\end{figure*}
\ifthenelse{\boolean{thesis}}{\end{landscape}}{}

\begin{figure*}
	\centering
	\includegraphics[width=0.65\linewidth]{fig5_symmetrical_1D_pdf.png}
	\caption{The smoothed distribution of different offsets of 43 clusters with all 768
		projections. The smoothing bandwidth is determined by Scott's rule
		\citep{Scott2010} for 
	visualization.
	For estimates where several peaks of galaxy data are 
	possible, only the densest peak is matched to the DM peak for computing
	the offsets in this figure. 
	The dark blue area indicates the 68\% density interval
	while the light blue area shows the 95\% density interval. 
	A summary of the statistic of each distribution is available in
	Table \ref{tab:p_val_table}. 
		\label{fig:offset_distributions}}
\end{figure*}
We also show $\Delta x_{\rm obs}$, the offset perpendicular to
$\Delta y_{\rm obs}$, for comparison.

For most of the observed offsets, we obtain the estimates from the contour plots 
and descriptions in the corresponding papers. 
For the offsets that are roughly in line with the axis connecting the two subclusters,
we let $\Delta y = |\Delta {\bf s}|$. 
If $\Delta s_{\rm obs}$ is not aligned along the line joining the subclusters,
using $|\Delta s_{\rm obs}|$ instead of $\Delta y_{\rm obs}$ to come 
up with a p-value from the distribution of 
$\Delta y$ will lead to a spurious increase in significance.

The actual significance of each observation is computed by comparing the
observed offset to the distribution of $\Delta y$ computed from our data. 
The distributions of $\Delta y$ represent the possible ways that offsets can be observed in a CDM
universe, giving us a rough estimate of the probability 
of seeing the offset from observations under the null hypothesis of CDM 
being true. 
We compute the two-tailed 
p-value from the narrowest density interval (C) of simulated offsets 
that is above the observed values of offsets in the literature, 
i.e. the significance of each observed offset is rounded up to the nearest 68\%, 95\% or 99\%
interval of the corresponding offset distribution from the Illustris data. 
\begin{equation}
	p = 1 - C(|\Delta y| > \Delta y_{obs})
\end{equation}
This underestimates the probability that the
observed offset is compatible with the CDM model so
any disagreement with the CDM model will be more obvious. 

 
\section{Results} 
\label{sec:results}

\ifthenelse{\boolean{thesis}}{\begin{landscape}}{}
\begin{table*}
	\begin{center}
		\caption{Robust estimates and the distribution of offsets along the y-axis.
			Section \ref{subsec:hypothesis_test} explains how $\Delta y$ is
			different from the offset magnitude which has a discontinuity at zero.
		\label{tab:p_val_table}
	}
	\input{Chapters/p_val_table.tex}
	\end{center}
\end{table*}
\ifthenelse{\boolean{thesis}}{\end{landscape}}{}

\ifthenelse{\boolean{thesis}}{\begin{landscape}}{}
\begin{table*}
	\small
	\centering
	 \caption{Observed offsets from clusters with reported evidence of mergers
		 along line connecting two subclusters ($\Delta y$) and the approximate 
		 perpendicular offset ($\Delta$ x).
		 The Table mainly contains clusters that have been used to constrain
		 $\sigmaSIDM$ using the reported offsets.
	 Any approximate  
	 error estimates are the corresponding 68\% lensing peak uncertainty
	 in the figure(s) listed in the reference column, this is due to the lack of uncertainty
	 estimates from the galaxy summary statistics from most literature. 
		Error estimates are omitted when they are not reported by the authors in
		any form. All masses are reported for the subclusters listed under the
		subcluster column. 
	 All p-value lower bounds are reported by matching to the corresponding method for
	 estimating galaxy summary statistic in Table \ref{tab:p_val_table}.
	 \label{tab:offset_results}} 
		\ifthenelse{\boolean{thesis}}{
			\resizebox{1.35\textwidth}{!}{
			\input{./Chapters/chapter3_offset_results}
			}
		}{
			\input{./Chapters/chapter3_offset_results}
		}

	 \raggedright{
		 {\it num.} is a short hand for the peak estimate from the number
		 density map. \\
		 {\it lum.} is a short hand for the peak estimate from the luminosity
		 density map, or KDE' in the method description. \\
		 {\it SL} is a short hand for strong lensing. \\
		 {\it WL} is a short hand for weak lensing. \\
	 }
\end{table*}
\ifthenelse{\boolean{thesis}}{\end{landscape}}{}

\subsection{The dynamical states (relaxedness) of the clusters}
Out of the 43 clusters $ \times$ 768 projection / cluster  = 33 024 projections, $\sim 45\%$ of the projections 
have one dominant luminosity peak and negligible substructures, with the total peak density of the
projection being $\nu \leq 1.2$. 
Another $\sim 50\%$ of the projections have more than one dominant luminosity
peak with $1.2 < \nu < 2.2$ (see Fig.
\ref{fig:projected_KDE_offset_distribution}).
Visually, the spread of the $\nu$ distribution is indicated by the horizontal 
length of the blue box. 
The median $\nu$ per cluster is indicated by the red central vertical line
inside each box in the left column of Fig. 
\ref{fig:projected_KDE_offset_distribution}.
Only 7 clusters (with ID = 15, 16, 17, 22, 31, 35, 51) out of 43 clusters have $\nu
\lesssim 1.2$ for most of the projections.
Clusters with median values of $\nu > 2.2$ usually have multiple subclusters.
The cluster with ID = 7, for instance, is made up of around 4 disconnected clusters that span
several Mpc.  
There is also a strong correlation of $\sim 0.8$ between $\nu$ and 
each of the two unrelaxedness quantities defined in section 
\ref{subsubsec:relaxedness}. 
This shows that $\nu$ can be a good indicator for the dynamical state of the
cluster.


\subsection{Offset between the matched DM peaks and the corresponding most
bound particle}
\label{subsec:offset_from_most_bound_particle}
There is no significant difference between the matched DM peaks and 
the most gravitationally 
bound particle (hereafter most bound particle).
The median of the offset between the DM peak and the gravitationally bound
particle is (0, 0) kpc. The 75-th percentile of the offsets are at ($\pm2,\pm2$) kpc. 
Most of the other offset values occur below ($\pm 9, \pm 9$) kpc. Large offsets
are only seen for clusters with $\nu > 1.2$. The densest DM peak in 3D where
the most bound particle is located does not
necessarily correspond to the densest projected peak in 2D in the presence of 
significant DM substructures.   

\subsection{Offset between galaxy summary statistics and the most bound particle}
As another sanity check, we computed the offsets between different galaxy summary
statistics and the most bound particle. 
Interested readers can refer to Table
\ref{tab:most_bound_particle_offset_distributions} for the different
percentile and robust estimates of the distribution of offsets from the most bound 
particle. 
The ranking in terms of increasing distance 
to the most bound particle computed by each method is as follows:
\begin{itemize}
	\item the BCG, 
	\item the densest peak of the luminosity map created by weighted KDE, 
		\item the shrinking aperture center from the luminosity weighted galaxy data,
		\item the densest peak of the number density map created by the unweighted KDE,
		\item the centroid estimate using luminosity weights, which is a proxy for the
			center of mass.
\end{itemize}

In fact, most of the BCG offsets are very small except for the two clusters with ID 13
and 33. Both clusters have  values of $\nu > 1.5 $ over each and every projection. 
From the projected density map, we further confirm that
both clusters have significant substructures. It is therefore possible for the
most bound particle to have a similar gravitational potential level as another 
substructure where the BCG is located. 
In general, the offset distributions between the galaxy summary statistics and
the most bound particle have approximately the same level of variance but more
extreme outliers (at the 99\%) than the
offset distribution between the DM peaks and the corresponding galaxy summary
statistics.

\subsection{Galaxy-DM Offset in Illustris}
\label{subsec:galaxyDMoffset}
\subsubsection{The two-dimensional distribution and the distribution of $\Delta y$}
The 2D distribution of $\Delta s$ from most methods peak at
around zero ($\lesssim 4$ kpc) with high rotational symmetry. 
The possible sources of offset asymmetry come from clusters with unusual configurations,
those clusters with more distinct, spatially separated subcomponents.
They are the clusters with higher offset variance over different projections. 
Their outlier offsets are in general more extreme than other clusters.
% Since there are a limited number of projections,
% clusters with such unusual configurations and offset levels 
% can leave patterns outside the main concentration of 2D offset data, such as rings. 
% This is due to projections that give similar views of the cluster. 
% The luminosity weighted centroid offset, i.e. median($\Delta x_{\rm
% centroid}'$) = -37 kpc, has the highest asymmetry along x-axis for the peak.
These offset distributions are recorded in detail in Table
\ref{tab:offset_distributions}. 

The method that gives the tightest offset is the BCG. 
The 2D offset $\Delta s_{\rm BCG}$ has most of its density located near zero
($\pm 3$ kpc) but 
contains outliers. Having outliers is possible 
as the DM peak is chosen as the closest DM peak to match the
brightest luminosity peak in a particular projection.
See the bottom right panel of Fig. \ref{fig:select_peak_visualization}, where the BCG 
coincides with the most bound particle. However, the luminosity peak of the
cluster is located at the other mass substructure. 
When there are distantly separated subclusters of similar masses, 
the brightest projected luminosity peak 
may shift from one subcluster to another subcluster between different projections,
while the BCG identification is unchanged between projections.
The aforementioned bias from substructure can be seen when we compare the
offset estimates between the relatively relaxed sample of $\nu < 1.2$ and the
unrelaxed samples $1.2 < \nu < 2.2$. The 99-th percentile increased drastically
from $\pm 19$ kpc to asymmetrical extreme estimates of $(-684, +1570)$ kpc.
Again, these values are possible because there can be several DM peaks of
similar density due to subclusters located far apart from one another.
The finite number of projections, combined with the substructures, have caused 
the 95-th and 99-th percentile tails of $\Delta y_{\rm BCG}$ of both the full
sample and the unrelaxed sample, but not the relaxed samples, to exhibit 
noticeable asymmetry.

From the different rows of Fig. \ref{fig:offset_distributions}, we can see 
that variance from each offset method is very different.
It is therefore unreasonable to compare offsets that are generated 
by different methods of peak inference across studies.
For the full sample in Table \ref{tab:p_val_table} and Fig. 
\ref{fig:offset_distributions},
the offsets computed by the peak from the luminosity weighted KDE 
has the second smallest variance. The 68-th percentile of $\Delta y_{\rm
KDE}'$ is at $\pm 25$ kpc. Using shrinking aperture to estimate
the peak location from the luminosity map increased the 68-th percentile of the
offset to more than double those of $\Delta y_{\rm KDE}'$ at $\pm 65$ kpc.
The peak estimate from the number density map has even larger variance, 
with its 68-th percentile being $\pm 84$ kpc. 

Most of the percentile intervals of the unrelaxed samples $ 1.2 < \nu < 2.2$ , 
when compared to the relaxed samples, are around a factor of 2 larger. 
Among the relatively relaxed samples, the variance of the inferred offsets from different
methods still show significant discrepancies. 
The variance of the offset computed from the shrinking aperture method, 
the number density map, and the weighted centroid are still at least a factor of 1.5
larger than those computed using the luminosity-weighted KDE. 
In particular, the 68\% percentile of the centroid method is $\pm 108$ kpc.
This is around one-fourth the typical core radius of massive clusters
\citep{Allen1998}. Our centroid estimates can be more extreme than observations
because we do not restrict the field of view.
The spread of the offsets inferred by each method affects their ability
for constraining $\sigmaSIDM$. We will further elaborate on this point
when we compare our results with staged simulations of SIDM in section
\ref{subsec:SIDM_sim}. 


\subsection{Offset projection uncertainty of each cluster}
\label{subsec:projections}
When we gather the offsets $\Delta s_{\rm KDE}'$ of the 
768 projections for each cluster,
we can find the offset uncertainty due to projection effects.
The distributions are illustrated in the box plot of Fig. 
\ref{fig:projected_KDE_offset_distribution}. The values of the biweight 
mid-variance of $\Delta y_{\rm KDE}'$ for half of the clusters
are $< 23$ kpc. Of the ten clusters (ID = 3, 7, 12, 20, 21, 32, 33, 37, 40 and 46) 
that have mid-variance $ > 40$ kpc, all of them have the median of $\nu > 1.2$
over different projections.
 
\subsection{Correlations between different variables and the offsets}
\label{subsec:correlations}
Here we investigate a list of physical quantities that are ordered in terms of
the significance of their correlations with the offsets in Table \ref{tab:correlations}. 
We use the Pearson product-moment correlation coefficient to quantify linear 
relationship between the pairs of variables
(aka Pearson's r,  hereafter $\rho$).
We describe the significance of the correlation 
based on the p-value reported by {\sc{Scipy}} of seeing the level of 
correlation by chance assuming the pair of 
quantities has no correlation. If the p-value is greater than 0.1, we consider the
correlation insignificant.
As a reference, the correlation between the 
two unrelaxedness criteria defined in section \ref{subsubsec:relaxedness}
for the 43 selected clusters is as high as 0.82. 
Note that most physical quantities are unique per cluster, such as the mass or
the richness.
For quantities that are not unique per cluster, but are projection-dependent,
such as the projected offset and the total normalized peak density ($\nu$), 
we compute a summary statistic, such as the
maximum of the offset, and the median of $\nu$, over all the projections of
each cluster. 
Then we compute the correlation between these summary statistics to the other physical quantities that
are unique for each cluster.
Overall, other than substructures that are represented by median($\nu$), and the two
unrelaxedness criteria of each cluster
projection, the projected offsets do not have significant correlation 
with other physical attributes of the clusters.


\begin{table*}
	\centering
% \captionsetup{justification=centering}
	\caption{Correlation between different cluster properties. See Section
		\ref{subsec:correlations} for a discussion.
	\label{tab:correlations}} 
\begin{tabular}{lcccc}
\hline 
Significance & Quantity 1 &  Quantity 2 &  Correlation & Relevant section\\
\hline
High & unrelaxedness$_0$ & unrelaxedness$_1$ & 0.82 & \ref{subsubsec:relaxedness}
\\
& unrelaxedness$_0$ & $\max(\Delta y_{\rm KDE}')$ &  0.70 &
\ref{subsubsec:relaxedness}, \ref{subsubsec:KDE}
\\ 
& unrelaxedness$_1$ & $\max(\Delta y_{\rm KDE}')$ &  0.80 & \ref{subsubsec:relaxedness}, \ref{subsubsec:KDE} \\ 
& median($\nu$) &  $\max(\Delta y_{\rm KDE}')$ & 0.77 & \ref{subsubsec:nu},
\ref{subsubsec:KDE}\\
\\ \hline
Medium & median($\nu$) & $M_{\rm FoF}$ & 0.28 & \ref{subsubsec:nu},
\ref{app:table_of_results}\\
\\ \hline
Low & richness & $\max(\Delta y_{\rm KDE}')$ & 0.21 & \ref{subsubsec:KDE}, \ref{app:table_of_results}\\  
& $M_{200C}$ &  $\max(\Delta y_{\rm KDE}')$ & -0.14 &
\ref{app:table_of_results}, \ref{subsubsec:KDE}\\ 
& $M_{500C}$ & $\max(\Delta y_{\rm KDE}')$ & -0.18 &
\ref{app:table_of_results}, \ref{subsubsec:KDE}\\
& $M_{FoF}$ & $\max(\Delta y_{\rm KDE}')$ & 0.13 & \ref{app:table_of_results}, \ref{subsubsec:KDE} \\
\hline
\end{tabular} 
\end{table*}

\subsection{The p-values computed from the hypothesis test}
We compiled Table \ref{tab:offset_results} with the corresponding lower bounds
for the p-values using
the $\Delta y$ distributions of the unrelaxed samples ($1.2 < \nu < 2.2$). 
The offset distributions in Table \ref{tab:p_val_table}
represent an estimation of the spread of $\Delta s$ in a $\Lambda$CDM universe.
The p-value lower bounds are reported based on the $\Delta y$ distribution 
from the same methods that the observed values were computed. 
The majority of the p-values from Table \ref{tab:offset_results}, 13 out of 15, are
$ > 0.05$, and only 2 p-values are below 0.05. 
This means the observations are mainly consistent with the null hypothesis: 
It is possible to see offset values as extreme as reported by observations
in a CDM universe $n_{\rm CDM}$, i.e. 
\begin{equation}
\offset_{\rm obs} \approx n_{\rm CDM}. 
\end{equation}
However, this result does {\it not} mean that the CDM model is more probable than the SIDM model. 
We will discuss the full physical implications of this result after discussing
all the factors that can affect this result. 
In Section \ref{subsec:non_SIDM_offsets},
we will first show our offset distribution results compared with
studies that investigate other causes of offsets that do not have a SIDM origin.
Then, in Section \ref{subsec:limitation_of_pvalue}
we will explore the factors that can affect our computation of the p-value due
to imperfect comparison to the merging cluster samples.   
We will compare our offset levels to simulations that present
estimates of SIDM offset levels in Section \ref{subsec:SIDM_sim}
and finally, discuss the full prospect of detecting and modeling 
$\offset_\SIDM$ properly in Section
\ref{subsec:prospect_of_detecting_SIDM}.
% We will discuss the full physical implication and limitations of this results in section  
% \ref{subsec:limitation_of_pvalue} after comparing our results to the SIDM signal 
% in section \ref{subsec:SIDM_sim}. 
% We continue to discuss the possible use of Table \ref{tab:p_val_table} and
% the p-values in Table \ref{tab:offset_results}.

% Each of the two unrelaxedness criteria has a significant positive correlation of $\sim 0.70$
% with the maximum of $\Delta s_{\rm KDE}'$ of each cluster
% (hereafter $\max(\Delta s_{\rm KDE}')$).
% The offset $\max(\Delta s_{\rm KDE})'$ per cluster also show a high
% correlation of 0.77 with the median $\nu$ per cluster (hereafter,
% median($\nu$)). The FoF mass of each cluster shows only a slight correlation of 0.28 with 
%  median($\nu$).
% 
% There is a weak correlation between the richness of the
% clusters with $\max(\Delta s_{\rm KDE})$ ($\rho = 0.21$). This weak correlation 
% may be due to 
% the fact that the peak estimate is only affected strongly by a few bright galaxies near 
% the peak. The richness is slightly more strongly correlated with the median of $\nu$ 
% with $\rho = 0.33$. 
% 
% There is an insignificant negative correlation ($\rho = -0.20$) between the 
% different masses 
% measured within a certain density threshold, such as $M_{200C}$, $M_{500C}$, 
% and $\max(\Delta s_{\rm KDE})$. The quantities $M_{200C}$ and $M_{500C}$, which
% are computed within a shell centered on the most bound particles, have
% symmetry assumptions that may not capture the total mass well if there are substructures. 
% The FoF mass, which
% captures the total mass without any symmetry assumption, correlates positively
% and weakly 
% ($\rho = 0.13$) with $\max(\Delta s_{\rm KDE})$. 


\section{Discussion}\label{sec:discussion}
% There are ambiguities in the representation of the data of galaxy clusters. 

\subsection{How to best visualize the cluster galaxy data?}
Before we discuss the origin of offsets, we turn our attention to how to best
visualize cluster data. The visualization of a cluster may give
the impression of the dynamical state of the cluster and set an expectation of
the offset for both the readers and the person creating the figure. 
Being able to compute a scientifically accurate visualization
with well-justified parameter choices, is therefore very important in scientific literature.
We inspected both the luminosity maps and the
number density maps of the member galaxy populations.
With the same selection of bright galaxies of apparent $i$-band$ < 24.4$ at
$z=0.3$, the luminosity maps in general resemble the DM maps more closely than 
the number density maps.
A comparison of the projected 
DM map, the luminosity map and the number density map of 129 clusters 
can be found at \href{https://goo.gl/kZUWrg}{https://goo.gl/kZUWrg}, 
\href{https://goo.gl/R7VNi9}{https://goo.gl/R7VNi9} and
\href{https://goo.gl/lmQUPd}{https://goo.gl/lmQUPd} respectively. 
We encourage our readers to see how it is possible
to create scientifically accurate luminosity contours 
that resemble 
the DM distribution if the member galaxy
data is of high completeness and purity (Visit
\href{https://goo.gl/kZUWrg}{https://goo.gl/kZUWrg}). Thus, 
the KDE is more than a method for
identifying the luminosity peaks
\footnote{As the high resolution figures need to be downloaded, the 
corresponding Jupyter notebooks may take some time and several refreshes of the
web page before they are rendered properly}.

% In real observations, missing selection of member galaxies, or 
% foreground objects can both affect the inference of the galaxy spatial 
% distribution. The number density map can be less susceptible to bias from bright 
% foreground objects. The effect of missing member galaxies 
% for computing the luminosity map is unclear because there is a selection bias favoring 
% bright member galaxies.
% 

\subsection{Comparison of the offset results to studies of clusters and groups}
\label{subsec:non_SIDM_offsets}
Our results showing the offset distributions are highly relevant to two types of
observational studies: 
The first type includes lensing studies that aim to study the general properties of 
galaxy clusters. The main goal of these studies is to estimate the spatial maps or 
the mass of the DM distribution of galaxy clusters. 
The second type focuses on inferring cosmological parameters from the 
mass function of galaxy groups. To do so, these studies stack galaxy 
groups to achieve a high enough signal for mass inference.
From our literature review and our results, we found that
the BCGs have the tightest offsets from the DM peaks in cosmological simulations. 
Observational studies, however, in general do not find offsets as tight as the 
simulations. We discuss some factors (other than SIDM) that 
have been shown to affect the observed offsets, including the lensing resolution and the
choice of the summary statistic for the member galaxy population. In particular, 
in the comparison of the luminosity peak to other galaxy summary statistic,
the luminosity peak shows promise to give the second least amount of bias,
after the BCG. 
 
To establish the baseline of the tightest $\Delta s$, we first discuss and 
compare the $\Delta s_{\rm BCG}$ constraints.   
\cite{Cui2015} studied 184 galaxy clusters with M$ > 10^{14}$ M$_\odot$ in an
N-body and hydrodynamical cosmological simulation suite powered by GADGET-3. 
% simulation suite with two types baryonic feedback prescription models,
% including radiative cooling, start formation and supernovae feedback, but one with feedback from Active
% Galactic Nuclei (AGN) and one without, \cite{Cui2015} 
In their study, they also identified the maximum smoothed particle hydrodynamic (SPH) density peak
to summarize 
the galaxy population in their cluster samples. \cite{Cui2015} found
the majority of offsets between BCGs and the most gravitationally bound particle to be
below 10 $h^{-1}$ kpc. They also reported some extreme outliers 
spanning up to several hundred $h^{-1}$ kpc due to the disturbed morphology of
some clusters. Our 
tight 68-th percentile of 
$\Delta y_{\rm BCG}$ at $ \pm 3$ kpc gives some confidence that 
we have identified most of the BCGs correctly in the Illustris simulation.

The distributions of $\Delta s_{\rm BCG}$ derived from simulations, in general, 
are less spread out than those computed in most observational studies.
For example, \cite{Oguri2010} have analyzed 25 X-ray luminous 
massive galaxy clusters of the LoCuSS survey. 
Observations were performed with a large FOV ($\sim 3 h^{-1}$ Mpc on a side) 
using the Subaru Suprime Camera. 
By fitting elliptical NFW models to the weak lensing data, \cite{Oguri2010}
showed a long tail distribution for $\Delta s_{\rm BCG}$, which they fit with two 2D Gaussians.
The first tighter 2D Gaussian had a standard deviation being 90
$h^{-1}$ kpc for describing the
offset for most clusters, a substantially larger width than we found for the
68-th percentile of $\offset_{\rm BCG}$. 
The long tail of the offsets from \cite{Oguri2010} spanning around 1 Mpc was fit by a second 2D
Gaussian with a standard deviation of 420 $h^{-1}$ kpc. This second component
in the tail region contains $\sim$ 10\% of the clusters in the study and is
consistent with the portion of extreme outliers that we have.   
% Note that by subsetting to only consider relatively relaxed clusters, 
% there is a tight maximum bound $\pm$19 kpc for $\Delta y_{\rm BCG}$ in our study. 

One major source of uncertainty for computing $\Delta s_{\rm BCG}$ is
BCG misidentification.
To see the effects of BCG misidentifications, 
some studies have made use of N-body hydrodynamical cosmological
simulations to compute the 2D distances between the BCG and 
the second most massive galaxies. \cite{Johnston2007b} and 
\cite{Hilbert2010} (using the Millenium simulation)  found 
the one sigma level offsets for misidentified BCGs at 380 $h^{-1}$ kpc, and 410 
$h^{-1}$ kpc respectively. This is consistent with the 95-th percentile of the
unrelaxed and the full sample of the BCG in our study and also the tail of the
$|\Delta s_{\rm BCG}|$ for \cite{Cui2015}. If one wishes to use the BCG with high
confidence, it may be necessary to set a stringent standard of the morphological
characteristics such as requiring a large half light radius for classifying a BCG.

Another source of uncertainty for $\Delta s_{\rm BCG}$ is from lensing. 
\cite{Dietrich2012} performed an analogous analysis of the work of \cite{Oguri2010} 
using the N-body Millenium Run (MR) simulation.
They showed that a combination of shape noise and modeling choices 
alone can lead to hundred-kpc-level offsets between the most bound particle 
(a proxy of the BCG) and the lensing peak for cluster-sized DM halos 
(M $> 10^{14 }M_\odot$).  
\cite{Dietrich2012} ray-traced through the DM substructures in the MR simulation 
as mock lensing observation of 512 clusters.  
Without any smoothing or shape noise, \cite{Dietrich2012} showed 
that 90\% the distance between the lensing peak and the 
most bound particle (a proxy for the BCG) is around 2.0 $h^{-1}$ kpc
(0.65 arcsec at z = 0.3). 
With shape noise,
even at the source galaxy density of space-based quality optical data of n = 80
arcmin$^{-1}$, fitting NFW halos and using the center as the DM gave a 
distribution of $|\Delta s_{\rm BCG}|$ with a mode at around 9 arcsecs (this is
approximately the 1 standard deviation estimate in 2D --- see Section
\ref{subsec:hypothesis_test} for how the transformation of a 2D Gaussian
distribution is related to a 1D Rayleigh distribution). 
Lowering the source galaxy density to 30 arcmin$^{-2}$ increased the mode
to 22 arcsec ($\sim$ 90 kpc at z = 0.3) with a 95-th percentile at 85 arcsec 
($\sim 400$ kpc at z = 0.3, comparable to \citealt{Oguri2010}). 
Smoothing, in the presence of shape noise,
resulted in an offset distribution with the mode at
15 arcsec ($\sim 60$ kpc at z = 0.3). 
The offsets do not simply depend on the smoothing bandwidth, 
but also the number density of the source galaxies that are lensed. 
While the uncertainty from smoothing the DM map is
relatively unimportant in the Illustris analysis due to the much higher resolution 
of the DM particles than the sparser source galaxies used for lensing, it
highlights why the bootstrapped uncertainties from the observed
DM peak need to be accounted for during the comparison between the
Illustris results and the observations.
% A related discussion of how to determine the best fit smoothing
% bandwidth of mass maps using gravitational lensing technique can be found from
% \cite{Marshall2002}.
For weak lensing analyses of the DM distributions,
it is noteworthy from the work of \cite{Dietrich2012} that 
smoothing alone can cause the peak offset to shift from several arcsecs to
around 1 arcmin.
Any other morphological features from the smoothed DM map will be subject 
to uncertainty of similar order of magnitude as the peak
estimate, but with a lower signal. 
In fact, there have been several contentious weak lensing studies (\citealt{Clowe2012},
\citealt{Jee2014b}, \citealt{Wittman2014}, \citealt{Cook2012})
reporting how the mass peaks of DM can appear or disappear based on
different selection and treatment of the source galaxies for lensing. 
Although strong lensing analyses can overcome issues with smoothing, 
there is still a risk of seeing substructures that mimic the sought-after 
morphological patterns. 
It is therefore difficult to use morphological features, such as the tail or the shape 
of a peak,
as suggested by \cite{Kahlhoefer14} for constraining SIDM.
% After all, other cosmological experiments 
% that have shown
% that it is possible to detect patterns once scientists look hard enough, 
% such as the initials of Stephen
% Hawking in the seventh-year Wilkinson Microwave Anisotropy Probe (WMAP) 
% Cosmic Microwave Background data \citep{Bennett2011}.

Now we turn to exploring complementary methods for summarizing
the galaxy population of a cluster, and show that  the luminosity peak 
is the second best choice after the BCG for summarizing the galaxy statistic.
There can be several bright galaxies that have about the same brightness 
in a cluster (or a subcluster). There may not be a physically dominant galaxy.  
Bright galaxies in the dense region of the cluster are the possible progenitors 
of the BCG and therefore a reasonable choice when there is no unique BCG. 
\cite{George2012a}, for example, examined 129 X-ray selected non-merging galaxy 
groups in the COSMOS field.
They found that around 20\% to 30\% of groups have non-negligible discrepancies
between different galaxy centroids. 
By stacking on a bright galaxy near the X-ray centroid, they found  
the resulting lensing strength is higher than the stacked lensing signal based
on other galaxy centroids, including the BCG. 
For groups with clear BCG candidate, \cite{George2012a} gave the range of
offset between the BCG and the assumed halo center as $\lesssim 75$ kpc. 
The KDE peaks from the luminosity maps of the Illustris samples show a much 
tighter offset to the 
lensing center than any other centroids that \cite{George2012a} investigated. 
The weighted or unweighted centroid measurement from \cite{George2012a} has a 
$|\Delta s|$ with standard deviation at 50 - 150 kpc from the
lensing center with long tails (of around several hundred kpc). 
In comparison, the median (26 kpc), mean (37 kpc), standard deviation (35 kpc) 
and 75-th percentile (49 kpc) of 
$|\Delta s_{\rm KDE}|$ from all the Illustris samples are below 50 kpc. 

% [This study is too weird to be included - the FOV is unusually small]
% The feasibility of using luminosity peak as a complementary method to represent
% the galaxy population has also been verified in observations.
% Using 10 000 Sloan Digital Sky Survey (SDSS) galaxy groups and clusters 
% in the Gaussian Mixture Brightest Cluster Galaxy (GMBCG) catalog \citep{Hao2009},
% \cite{Zitrin2012} were able to use the smoothed luminosity maps of the red-sequence 
% galaxies to locate the BCG, which the authors assumed to be the proxy of the DM peak. 
% The richness of the groups range from tens of members to around 160 members. 
% After optimizing the different degrees of smoothing polynomials and 
% assuming a power-law spatial distribution of galaxies, \cite{Zitrin2012} found
% a 24-th degree spline interpolation to best fit the galaxy data within a small
% assumed FOV of
% 120 arcsec$^{2}$  for a luminosity peak. (This FOV translates to 
% $\sim$ 110 $h^{-1}$ kpc$^2$ for the redshift range in the
% paper \citealt{Zitrin2012}). The densest luminosity peak from the spline interpolation had 
% a very close agreement with the identified BCG those mode is $\sim$ 4.2
% $h^{-1}$ kpc after removing 12\% of outliners those offsets are about as wide
% as the FOV. 

% There are also possible differences in the accuracy of our peak
% estimation method and other studies. 
% The population mid-variance of $\Delta y_{\rm KDE}$, which quantifies the
% population bias from the DM peak estimation, is 23 kpc (the 68-th percentile is
% $\pm$ 25 kpc).

% Finally, we try to conclude this subsection by discussing how the offset 
% information of different summary statistic of a cluster can help center the cluster for
% stacked lensing analysis. 
% The equation for modeling the density for stacked clusters usually 
% involve a density term for the BCG,
% one halo term centered on the BCG, some miscentering correction, and a nearby
% halo term \citep{Johnston2007b}. 
% When the galaxy summary statistics disagree (offset $> 50$ kpc),  
% the BCG (and luminosity peak) often land on top of one of the dense subcomponents
% of a generally asymmetrical spatial distribution.
% The weighted centroids,  
% which are the proxies for the center of mass for these disturbed clusters,
% on the other hand, often land in between dense substructures.
% For such an asymmetrical cluster, 
% there is no point location that will simultaneously satisfy the
% requirements of 1) maximizing the density, and 2) preserving symmetry.
% If a high precision is required, one can do it at the sacrifice of a smaller sample size. 
% One can only stack clusters those galaxy summary statistics, e.g.
% the centroid and BCG (or the luminosity peak), have high degree of agreement.
% To take care of the complex morphology for clusters with multiple components,
% a more sophisticated stacking model is needed.
 
  
\subsection{Comparison to merging cluster observations for SIDM constraints 
}
\label{subsec:limitation_of_pvalue}
We showed that it is possible for observed offsets $\offset_{\rm obs}$ to be 
compatible with the distribution of $n_{\rm CDM}$ as part of the p-value test. 
However, there are reasons why we think the p-values may be underestimated.
Our study, by design, presents some of the most ideal observational conditions. 
Our goal is to investigate how the minimum level of statistical noise would 
compare to the SIDM signal.
Unaccounted sources of noise in the cited observed studies  
% increase the variance of the observed offset distribution. 
can lead to a broader noise ($n_{\rm CDM}$) distribution than the estimated distribution in the
Illustris simulation. 

First, we have assumed an unobstructed line-of-sight for our clusters. 
% This allows all subcomponents to affect our peak estimates.  
% In real observations, the field of view usually focus on $R200C$ or $R500C$ 
% and may not observe all the substructures.
In real observations, there can be foreground galaxies, whose noise contribution
theoretically has a uniform spatial distribution. 
This contribution can add large spatial variance to the estimate of ${\bf
s}_{\rm gal}$. 
Second, our DM mass map has assumed a resolution that is only achieved for clusters 
with many strong lensing constraints. 
Most analyses of clusters have DM maps with lower resolution. 
The observed galaxy clusters can also have high stellar contamination
if the cluster happens to be located near the plane of the Milky Way 
(such as the Sausage cluster; \citealt{Jee2015}). 
Such stellar contamination can decrease the number density of the visible source galaxies for the
lensing analysis, resulting in a degraded resolution of the DM mass map and a
biased estimate of ${\bf s}_{\rm DM}$. 
  
Third, most studies have {\it not} used estimators of comparable precision, especially for
the estimate of the luminosity peak. We have used the cross-validated KDE that
minimizes the fitting error. Not only does the algorithm help
determine the eigenvalues of the bandwidth matrix for smoothing, 
but also the optimal eigenvector direction of the matrix. 
Most literature does not treat the inference of the smoothing bandwidth 
of the data to be a regression problem that aims to minimize the fitting error.  
% It is unclear if such results will enjoy the same accuracy level as what
% we demonstrated. 
If scientists hand tune the smoothing bandwidth, it is difficult to
avoid setting the bandwidth to fit the preconception of how the density
contours of the cluster 
should look like, and inadvertently biasing $\Delta s$. We therefore strongly
advocate treating the smoothing of galaxy luminosity as a regression problem.
The best fit bandwidth should be found either via 
the cross-validated KDE method that we provide, or other optimization  
procedures that minimize the fitting error.


% Here we discuss the optimistic assumptions that we have made in this analysis  
% that may result in small p-values.
% While the compilation of the offset distribution suffers 
% from the small number of high mass clusters in the Illustris simulation, 
% the distribution probes projection uncertainties comprehensively. 
% Possible discrepancies that affect our comparison can arise
% due to the high purity and completeness of the Illustris galaxy data.
% Most observations of massive galaxy clusters with a total mass of M$_\odot
% \approx 10^{14}$ have richness $\lesssim 300$, while the most massive Illustris
% cluster (M$_{\rm FoF} = 3.23 \times 10^{14} M_\odot$) has a richness of 483.
% Furthermore, the Illustris clusters are less massive than the observed clusters
% with huge offsets. The Illustris clusters may also provide sufficient samples
% of possible spatial configurations of observed clusters.
% Despite the possible differences, we try to do a
% fair comparison to observation by matching the method of offset inference. 

Other complications may arise from the mismatch of the physical properties of 
our cluster samples with the observed clusters, although the actual effect of the
property mismatch is inconclusive. 
For the full sample of Illustris clusters in Table \ref{tab:p_val_table}, 
each cluster has the same number of projections. 
However, it also underestimates the offset spread because the
full sample includes $\sim 45\%$ of relatively relaxed projections 
that only have one primary luminosity component.  These clusters would
have been excluded for comparison with bimodal mergers. 
Subsetting with $1.2 < \nu < 2.2$ picks out
cluster projections that are in more similar dynamical states as the observed merging
cluster. 
However, some simulated clusters may have more projections included in this sample
than the other clusters. From the inspection of the mass abundance relations in 
Fig. \ref{fig:mass_abundance_distribution}, we found that subsampling with $1.2 <
\nu <2.2$ includes a higher proportion of projections from massive clusters
($\sim 20\%$ more) than 
the full sample. 
This sampling should not introduce significant bias, 
the sample of observed merging clusters are still more massive than our
unrelaxed samples. From the weak correlation value between the $M_{\rm FoF}$ and
$\Delta y_{\rm KDE}'$ that we found, using less massive clusters may not lead to a significant
change of our estimation of $n_{\rm CDM}$.  

% There are caveats when we consider the {\it statistical}
% contributions from the possible source of discrepancies listed above. 
% For a small number of clusters,
% these contributions does {\it not} always guarantee an increase in 
% $|\offset|$ or $\Delta y$. 
% 
% With these additional sources of noise,
% we can only see an increase in the {\it variance} of the distribution of the noise
% component for a sufficient number of observations. 
% By definition, the 2D distribution of noise does not have a preferred direction. 
% Right now, 
% the 15 offsets from merging clusters that we have compiled are due to different
% methods. Six of them are compiled with the luminosity peak method, Seven of them
% are from the number density peak method, and one of them with the BCG method. 
% We are unable to claim that our p-values are secure due to the small number of
% statistics from only .  


% it is not very likely that such discrepancy can bias the directional offset 
% $\Delta y$ estimates low.  
% For the 1D offset $\Delta y_{\rm obs}$, the allowed configurations for the noise 
% to bias the offset low is 
% proportional to the value of $\Delta y$. For the 2D offset $\Delta s$, the
% allowed configuration for the noise
% to bias the offset low is proportional to $|\offset|^2$.

% To avoid any report from this study directly quoting a p-value, we did not
% combine the p-values from the different observations. 
Due to the above possible discrepancies, we did not combine the p-values from
the observations. The computation of p-value does not fully
take the uncertainties of the observations into account. 
% We are unable to take the quoted uncertainties of the lensing estimates 
% from Table \ref{tab:offset_results} into account. 
% are only 
% from the lensing estimate, but not the error estimates of the galaxy summary 
% statistic. 
Any future studies that wish to claim significance based on a 
p-value comparison to a simulation will 
need to carefully track down and simulate the contribution of uncertainties 
from each aspect of the cluster analysis. 
% We caution the reader that a combined p-value test from a sample of merging 
% clusters has a list of caveats     
% It may be reasonable to inversely weight offsets by the 
% reported bootstrapped uncertainty $|\Delta s|$ for each cluster.

% Only the population estimate of offsets in a CDM universe, i.e. the mean,
% gives zero offset.  
% At this point, it is unclear that the analysis with a population of
% merging clusters, can provide an excess in population offset signal at a
% characteristic scale above the noise level, and give 
% better estimates for $\sigma_{\rm
% SIDM}$ than the study of an individual cluster.  


\subsection{Comparison to staged simulations with SIDM}
\label{subsec:SIDM_sim}
Staged simulations are controlled probes of the contribution
of SIDM to offsets in mergers of cluster components. 
The non-deterministic nature of particle interactions means that it is not easy
to predict the offsets analytically without simulations.
Furthermore, there is no consensus on what type of clusters might best show the
effects of SIDM, which depend on the model of the SIDM.
Currently, the studies of SIDM in mergers have been restricted to those with isotropic
scattering and velocity-independent cross sections.   
The two main classes of SIDM that are studied include those with 
frequent, long-range interactions that can be broadly be modeled by an
effective drag force, and those with rare, shorter range interactions those
effects are not well approximated by a drag-force \citep{Kahlhoefer14}. 
Here we examine the offsets $\offset_\SIDM$ provided by different cluster merger 
simulations that contain SIDM physics and compare to our offset results. 
We further explore the implications of having a non-deterministic SIDM offset signal for
formulating a proper analysis. 

At SIDM cross section level favored by current literature $\sigmaSIDM
\lesssim 1~\centi\meter^2 ~\gram^{-1}$, a list of SIDM simulation studies (Kim
et al. in prep, \citealt{Robertson2016}, \citealt{Kahlhoefer14}, \citealt{Randall2008d})
have reported that, when the offset is observable, 
the maximum offset generally increases with $\sigmaSIDM$. 
A {\it maximum} offset of 40 kpc was reported for $\sigmaSIDM = 1
~\centi\meter^2 / \gram$ under high concentration of the DM component of the 
merging clusters. Increasing the cross section to $\sigmaSIDM = 3
~\centi\meter^2 / \gram$ only increased the {\it maximum} offset to 
approximately 50 kpc.
The maximum signal of $\offset_\SIDM = 50$ kpc is within 
the one-sigma level of the Illustris offsets 
inferred by the shrinking aperture method, the number density method, and the
centroid method. This maximum value is also within the two sigma value of the
luminosity weighted KDE offset and the BCG offset level and several times below
$\max(\Delta y_{\rm KDE}')$ and $\max(\Delta y_{\rm BCG}')$. 
This means:
\begin{equation}
	n_{\rm CDM} > \offset_\SIDM.
\end{equation}
and combined with our previous comparison with the observed level of offsets,
we have:
\begin{equation}
	\Var(\offset_{\rm obs}) \approx \Var(n_{\rm CDM}) > \Var(\offset_\SIDM).
\end{equation}
There are several implications from this result showing that the 
noise could dominate the signal. 
% If all clusters are assumed to have constraining power of SIDM even when the
% opposite is true, 
First, if we want to ensure a high signal to noise ratio for possible
$\offset_\SIDM$ detection, one should choose to use either the KDE or the 
BCG method for inferring the offset.
Second, if an analysis of an individual cluster assumed $\offset_{\rm obs} \approx \offset_\SIDM$ 
for constraining $\sigma_\SIDM$,
while instead $\offset_{\rm obs} \approx n_{\rm CDM} + \offset_\SIDM$ with
$n_{\rm CDM} >
\offset_\SIDM$ is a better approximation, it  
can lead to an overestimation of $\sigma_\SIDM$. 
% To give confident estimate of $\sigma_\SIDM$, one may need 
% a large number of clusters to better evaluate 
% the statistical contributions from each term in eq. \ref{eq:signal_and_noise}.

\subsection{Prospect of detecting SIDM with confidence based on our results} 
\label{subsec:prospect_of_detecting_SIDM}

To improve upon the hypothesis test that we have provided in this study, 
one way is to provide a statistical model of 
the contributions of all the terms in eq. \ref{eq:signal_and_noise}.
% Using the results from staged merger simulations with SIDM physics to
% approximate $\offset_\SIDM$ and our result to model $n$,  
% Without going into details of how to characterize the
% distribution of the $\offset_\SIDM$ term, 
% the main difficulties for inferring $\sigma_\SIDM$
% It is difficult to propagate and characterize the observational 
% uncertainties in the observed offset. 
% Kim et al. (in prep.) have shown 
% that the SIDM offsets depend on the time of the 
% merger, impact parameters, collisional velocity and mass concentration. 
% Yet, there is no analytical model that includes all these merger
% parameters in the calculation of $\offset_{\SIDM}$, so we cannot propagate
% the uncertainties for $\offset_\SIDM$ analytically. 
% The left hand side of \ref{eq:signal_and_noise} can be estimated $\offset_{\rm obs}$ from
% observations. 
The left hand side of \ref{eq:signal_and_noise} requires $\offset_{\rm obs}$ estimates from
observations. 
It is more appropriate to treat $\offset_\SIDM$ term in eq. \ref{eq:signal_and_noise} 
as a distribution.
As the combined results from \cite{Kahlhoefer14} and Kim et al. (in prep.) have shown,
$\offset_\SIDM$ varies according to the cluster merger parameters (merger
velocity and impact parameter),
the cluster properties (spatial distribution of mass), 
and the merger phase (time dependence). 
Such variations of $\offset_\SIDM$ can be represented with a distribution.  
With our results, we have provided an optimistic estimation of the $n_{\rm CDM}$ term.

% With a rough estimation of $\offset_\SIDM$ based on SIDM staged merger simulations,
We can investigate how much discrepancy to expect between a CDM model 
and a SIDM model. 
% We do so with a rough estimation of the variance of $\offset_\SIDM$
% from the literature, and our estimates of the $n$ term.    
For instance, in eq. \ref{eq:signal_and_noise},
if the SIDM signal has little-to-no correlation with the noise, 
we can decompose the variance as:
\begin{align}
	\Var(\Delta y_{\rm obs}) &= \Var(\Delta y_\SIDM) + \Var(n_{\rm CDM}) + \cdots
\end{align}
A rough estimate of the distribution of $\offset_\SIDM$ over time 
can be read off from the staged simulation of an equal mass cluster merger of a
massive cluster ($10^{15}$ M$_\sun$) in Kim et al. (in prep.).
The offset ($\Delta y_\SIDM$) has an approximately zero mean, and a 3-sigma level of
$\sim 40$ kpc for $\sigma_\SIDM = 1~\centi\meter^2 / \gram$.  
We assume a noise level as estimated by the distribution of $\Delta y_{\rm KDE}'$
for the non-relaxed samples (one-sigma level at 32 kpc). This choice matches 
how Kim et al. (in prep.) used the DM and the galaxy peaks for their
offset measurements. 
Then a rough estimate of the difference in the standard deviation of the observed offset 
between a CDM
model and a model with $\sigma_\SIDM = 1~\centi\meter^2 / \gram$ is:
\begin{align}
	&	\sqrt{\Var(\Delta y_\SIDM) + \Var(n_{\rm CDM})} - \sqrt{\Var(n_{\rm CDM})} \\ 
&=	\sqrt{(40 / 3)^2 + 32^2} - 32 \approx 3~\mathrm{kpc} 
\end{align}
which is a subtle $\sim 9 \%$ difference between the CDM and the SIDM model with
$\sigma_\SIDM = 1~\centi \meter^2 / \gram$. 
Note that this assumed values of $\Var(\Delta y_\SIDM)$  
ignores the possibility
that future studies may find ways to select mergers at a stage when $\Delta y_\SIDM$
of each cluster merger is around its maximum possible value. 

We can also examine the difference of the standard deviation of the observed
offset level between the following two models with 
$\sigma_\SIDM =1~\centi\meter^2 / \gram$ and  $\sigma_\SIDM = 3~\centi\meter^2 / \gram$.
We assume an approximately zero mean, and a 3-sigma level of $\Delta y_\SIDM$
at $\sim 50$ kpc for $\sigma_\SIDM =
3~\centi\meter^2 / \gram$.
\begin{align}
	&\sqrt{\Var_{3\centi\meter^2/\gram}(\Delta y_\SIDM) + \Var(n_{\rm CDM})} -
	\sqrt{\Var_{1\centi\meter^2/\gram}(\Delta y_{\SIDM}) +\Var(n_{\rm CDM})}\label{eq:variance_difference}\\ 
&=\sqrt{(50 / 3)^2 + 32^2} - \sqrt{(40 / 3)^2 + 32^2} \approx 1~\mathrm{kpc} 
\end{align}
which is an even smaller $\sim 3\%$ difference between the two models. 
If the distribution of noise from observations has larger variance than what we
have shown, eq. \ref{eq:variance_difference} will show even less discrepancy
between the different SIDM models. 
The offset distribution with models of small $\sigma_\SIDM$ values 
can be indistinguishable.  

For future studies, there may be other ways of better formulating the
statistical framework.
Instead of the variance, an alternative statistical parameter 
may provide characterize the offset distribution with 
higher sensitivity than what we have illustrated above.
Regardless of the implementation details,
a good statistical model will enable the computation of a Bayes factor based
on all the important contributions to the observed offset.
The Bayes factor is the ratio of the posterior probability of a fit of SIDM model to data,
over those of a CDM model:
\begin{equation}
	\tau = \frac{Pr(\sigma_{\SIDM} = \sigma | \offset_{\rm
	obs})}{Pr(\sigma_{\SIDM} = 0 | \offset_{\rm obs})}.
	\label{eq:Bayes_factor}
\end{equation}
This ratio will show if a SIDM model with an assumed cross section value, $\sigma$,
is favored over a CDM model. Such a comparison will provide better
insight to the best-fit $\sigma_\SIDM$ value than our hypothesis test.
Our current hypothesis test can only quantify the compatibility between a CDM
model and the data but it does not describe the SIDM model. 
% we recommend a model comparison using \ref{eq:signal_and_noise}
% there needs to be understanding of the
% different contributions in \ref{eq:signal_and_noise}

Currently, there are not enough data points for us to estimate 
$\Var(\Delta y_{\rm obs})$ to a high precision. The methods for inferring 
the galaxy peaks of the existing studies may not be precise enough to 
achieve the optimistic noise level that we have shown. 
We also do not know $\Var_{\sigma_\SIDM}(\Delta y_\SIDM)$ well enough
to have meaningful constraints. 
To better estimate of the distribution 
of $\Delta y_\SIDM$, we need comprehensive SIDM simulations 
for cluster configurations that are
analogous to the observed mergers of clusters. 
One would also need a selective observational strategy
to find clusters that have a good chance of giving high $\offset_\SIDM$ signal
relative to the noise.  
From Kim et al. (in prep.), the clusters with a high chance of giving high
$\offset_\SIDM$ signals are massive cluster mergers with relatively low merger
velocities, small impact parameters and large halo concentrations.
Under such restrictive selection criteria for cluster samples, 
the Illustris simulation does not contain 
many analogous clusters for computing the denominator term in
\ref{eq:Bayes_factor}.
The results of this study, however,
have given an estimation of the distribution of the $n_{\rm CDM}$ term in
eq. \ref{eq:offset} and eq. \ref{eq:Bayes_factor}.  

% To come up with the selection strategy and compute $\ref{eq:Bayes_factor}$,
% there is a need to estimate the probability density function (PDF) of
% $\offset_{\SIDM}$ (over different merger configurations) from SIDM simulations. 

 
% \subsection{Possible improvements to better understand clusters}
% The data in the Illustris simulation has proven to be an excellent source for
% understanding observational uncertainties of galaxy clusters.
% Further work can be done to make mock observations more realistic with some of
% the following improvements:
% \begin{itemize}
% 		\item adding foreground structures in the analysis 
% 		\item improving the peak detection threshold from the KDE luminosity map based on
% 			the flux per area at the peak location and comparing that to observational
% 			limitations
% 		\item examining the effects of incompleteness by removing some member galaxies randomly 
% 		\item computing the velocity dispersion of the galaxies along different
% 			line-of-sight to see how the velocity dispersion correlates the different
% 			measures of unrelaxedness for different projections
% 		\item testing the selection of member galaxies using the red sequence
% 	\end{itemize}


\section{Summary}
There are two main aspects to this study. 
First, we have provided a comprehensive study of the various ways of summarizing 
galaxy-DM offset using the Illustris simulation. We concluded that:

\begin{itemize}
		\item the locations of the most gravitationally bound particle are consistent 
				with the BCG for systems with little substructure.  

		\item the BCG has the smallest one-sigma offset level to the dominant DM
			peak (68-th percentile of $\Delta y_{\rm BCG} \approx 3$ kpc for $1.2 <
			\nu < 2.2$).

		\item the identified BCG offsets have a heavy tail at $\Delta y_{\rm BCG} >
			160$ kpc for $1.2 < \nu < 2.2$. 
		 This heavy tail is due to a combination of effects from substructures and 
		 projection and is not seen in the relaxed sample with $\nu < 1.2$. 

		\item the KDE peak of the luminosity map after careful cross-validation 
			gives the second tightest one-sigma offset level ($\pm 32$ kpc for $1.2 <
			\nu < 2.2$) from the DM peak.  
			The length of the tail of the $\Delta y_{\rm KDE}'$ distribution
			($\lesssim \pm 124$ kpc at the 99-th percentile)
			is smaller than those of the BCG.

		\item a naive implementation of the shrinking aperture is easily affected 
			by substructures even for clusters with one
			dominant component. We do not endorse this method for drawing scientific
			conclusions nor visualization.

		\item the variances of the galaxy-DM offset measured from different methods
			of inferring the galaxy peak can differ by factors of a few. 
			One should not compare
			offset values computed with different galaxy peak inference methods.

		\item with high completeness and purity of member galaxy data, the
			luminosity map produced by a cross-validated kernel density estimate 
			resembles the DM spatial distribution more closely than 
			the number density map of member galaxies. We can quantify the relative
			densities of the luminosity peaks to the brightest peak for each 
			luminosity map. By summing all the relative densities of the luminosity
			peaks in the map, we can obtain a number $\nu$ for characterizing the amount of substructures in
			the cluster. 
\end{itemize}
Second, we have examined the implications of our results for studies that make use of
$\offset_{\rm obs}$ for constraining $\sigma_\SIDM$. We have shown that 
\begin{itemize}
		\item it is possible to see $\Delta s$ as extreme as those in observed merging 
			galaxy clusters assuming that $\Lambda$CDM is the true underlying physical model, 
	i.e. $\Var(\offset_{\rm obs}) \approx \Var(n_{\rm CDM})$.

		\item the contribution of statistical uncertainty to the galaxy-DM offsets 
			for $\Lambda$CDM clusters is {\it not} negligible when compared to the reported  
			levels of maximum offset from staged SIDM simulations ($\sim 50$ kpc),
			i.e. $\Var(n_{\rm CDM}) \gtrsim \max(\Delta y_{\SIDM})$.
		
		\item to maximize the SIDM signal, one should use either the BCG or the
			cross validated KDE method for measuring the offset.
			For the non-relaxed samples in our study ($1.2 < \nu < 2.2$),
		  only the 68-th percentile of the galaxy-DM offsets derived from BCG ($y_{\rm BCG}$) and 
			the cross-validated KDE luminosity peak	($y_{\rm KDE}'$)
			are smaller than the maximum SIDM offset ($50$ kpc) reported from SIDM simulations. 
			Other methods have one-sigma uncertainty levels that overwhelm the
			SIDM offset signal. 

		\item it is possible for SIDM models with small $\sigma_\SIDM$ values 
			($\sigma_\SIDM = 0, 1, 3~\centi\meter^2 / \gram$) to be
			nearly indistinguishable in terms of measured offsets. 
			Using a rough estimate of $\Delta y_\SIDM$ and an optimistic estimate of the
			noise level, we have shown that the offset variance between the
			SIDM models with small $\sigma_\SIDM$ values to only differ by $< 10\%$.

\end{itemize}
Finally, we caution that if an analysis assumed a wrong signal-to-noise ratio, e.g.
assuming $\offset_{\rm obs} \approx \offset_\SIDM$ while instead $\offset_{\rm obs}
\approx n$ is true, the estimate(s) of $\sigma_\SIDM$ will be biased.
To use the estimated noise level from our study, one should also match the
offset inference method.
For more secure constraints of $\sigma_\SIDM$,
we advocate future studies to formulate a statistical model 
to properly take the contributions shown in eq. \ref{eq:signal_and_noise} into 
account.

We have made all the code used in this work available at \\
\href{https://github.com/karenyyng/galaxy\_DM\_offset}{https://github.com/karenyyng/galaxy\_DM\_offset}.

\section{Acknowledgements}
% Our software setup is available through a Docker image on DockerHub while the
% The main code are version controlled via Git and GitHub. 
Karen Ng would like to thank Professor Thomas Lee for the helpful discussion of 
the construction of the p-value hypothesis test. We are immensely grateful for 
the technical review and comments from Prof. Maru\v{s}a Brada\v{c} and Prof. Annika Peter.  
Part of the work before the conception of this paper was discussed during 
the AstroHack week 2014. 
Part of this work was performed under the Hubble Space Telescope grant
HST-GO-13343.01-A, the National Science Foundation grant 
1518246 and under the auspices of the U.S. Department Of Energy by 
Lawrence Livermore National Laboratory (LLNL) 
under Contract DE-AC52-07NA27344; \ifthenelse{\boolean{thesis}}{}{LLNL-JRNL-XXXXXX-Draft.}
This work made use of {\sc IPython}
\citep{Perez2007}.
